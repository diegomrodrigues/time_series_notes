## Processos Univariados com Ra√≠zes Unit√°rias: Testes de Dickey-Fuller e Phillips-Perron

### Introdu√ß√£o
Como vimos anteriormente, a an√°lise de processos com ra√≠zes unit√°rias difere da an√°lise de processos estacion√°rios devido √†s taxas de converg√™ncia dos estimadores e das distribui√ß√µes assint√≥ticas de estat√≠sticas de teste [^1]. O conceito de movimento Browniano e funcionais do movimento Browniano s√£o essenciais para entender as propriedades assint√≥ticas desses processos [^1].  Este cap√≠tulo expande a discuss√£o para apresentar duas abordagens chave para realizar testes de hip√≥tese sobre a presen√ßa de ra√≠zes unit√°rias: a metodologia de Dickey-Fuller e a metodologia de Phillips-Perron, que abordam a quest√£o da correla√ß√£o serial em dados diferenciados de maneiras distintas. O m√©todo de Dickey-Fuller, atrav√©s da adi√ß√£o de defasagens na autorregress√£o, permite estimar as propriedades de todos os coeficientes e realizar testes sobre a raiz unit√°ria, enquanto o m√©todo de Phillips-Perron ajusta as estat√≠sticas para lidar com a correla√ß√£o serial, proporcionando alternativas para a an√°lise de processos n√£o estacion√°rios.

### Conceitos Fundamentais

No cap√≠tulo anterior, introduzimos o conceito de processos com ra√≠zes unit√°rias e o papel do movimento Browniano para descrever suas distribui√ß√µes assint√≥ticas [^1]. Vimos tamb√©m que a distribui√ß√£o assint√≥tica do estimador do coeficiente em um modelo AR(1) com raiz unit√°ria √© um funcional do movimento Browniano, diferentemente do caso estacion√°rio onde o estimador converge para uma distribui√ß√£o normal [^1]. Agora, vamos explorar os m√©todos pr√°ticos para realizar testes de hip√≥teses sobre a presen√ßa de ra√≠zes unit√°rias em modelos de s√©ries temporais, com foco em como lidar com a correla√ß√£o serial.

A presen√ßa de correla√ß√£o serial nas diferen√ßas de processos com ra√≠zes unit√°rias representa um desafio adicional na an√°lise estat√≠stica. A **correla√ß√£o serial** √© a correla√ß√£o entre os valores de uma s√©rie temporal em diferentes pontos no tempo, e ao analisar processos com raiz unit√°ria, √© fundamental levar em considera√ß√£o essa correla√ß√£o serial [^1].  As abordagens de Dickey-Fuller e Phillips-Perron s√£o m√©todos distintos que abordam este problema, sendo que Dickey-Fuller adiciona *lags* na autorregress√£o e Phillips-Perron ajusta as estat√≠sticas.

A abordagem de **Dickey-Fuller**, que adiciona *lags* √† autorregress√£o, √© uma extens√£o do teste b√°sico para raiz unit√°ria em que a estat√≠stica do teste √© constru√≠da por meio de uma regress√£o com uma ou mais defasagens na s√©rie temporal [^1]. Mais especificamente, em vez de modelar diretamente um processo de primeira ordem, modelos autorregressivos de ordem $p$ s√£o utilizados. Assim, ao inv√©s de usar uma auto regress√£o de primeira ordem para obter os resultados que dependem do movimento Browniano, uma auto regress√£o de ordem $p$ √© utilizada. Essa abordagem permite incorporar efeitos de correla√ß√£o serial na an√°lise [^1].
**Teorema 2** (Propriedades da Distribui√ß√£o dos Estimadores de um Modelo Autorregressivo com Raiz Unit√°ria) Em um modelo autorregressivo de ordem *p* ($AR(p)$), onde uma das ra√≠zes √© unit√°ria, os coeficientes dos *lags* estacion√°rios convergem a uma taxa de $\sqrt{T}$, com distribui√ß√µes assint√≥ticas normais, enquanto os coeficientes associados √† raiz unit√°ria convergem a uma taxa de $T^{3/2}$, seguindo a teoria do movimento Browniano [^1]. Os testes sobre a presen√ßa da raiz unit√°ria podem ser conduzidos usando funcionais de movimento Browniano. Este teorema estabelece as bases te√≥ricas para os testes de Dickey-Fuller e suas variantes, revelando o comportamento diferenciado dos estimadores em modelos com ra√≠zes unit√°rias.

**Lema 2.1** (Representa√ß√£o de Wold para Processos Estacion√°rios) Qualquer processo estoc√°stico estacion√°rio pode ser representado como uma combina√ß√£o linear de choques aleat√≥rios n√£o correlacionados, tamb√©m conhecido como representa√ß√£o de Wold.
**Prova do Lema 2.1:** A demonstra√ß√£o desse lema envolve a decomposi√ß√£o de um processo estacion√°rio em sua parte determin√≠stica e sua parte estoc√°stica, que pode ser expressa como uma soma ponderada de inova√ß√µes passadas. A prova detalhada pode ser encontrada em [^2]

Este lema √© √∫til, pois garante que, sob certas condi√ß√µes, podemos modelar os erros do processo, que podem exibir correla√ß√£o serial, como um processo linear estacion√°rio, e a partir da√≠, utilizar m√©todos estat√≠sticos apropriados para realizar infer√™ncia.
**Prova do Teorema 2:**
Para provar o Teorema 2, examinaremos o comportamento assint√≥tico dos estimadores em um modelo autorregressivo de ordem *p* ($AR(p)$) com uma raiz unit√°ria. A prova desse resultado requer a utiliza√ß√£o das ferramentas matem√°ticas apresentadas nos teoremas anteriores, como o teorema central do limite funcional.
I. Considere um processo $AR(p)$ que cont√©m uma raiz unit√°ria e √© modelado como:
    $$ y_t = \phi_1 y_{t-1} + \phi_2 y_{t-2} + \ldots + \phi_p y_{t-p} + \epsilon_t $$
    onde $\epsilon_t$ √© um ru√≠do branco com m√©dia zero e vari√¢ncia $\sigma^2$.

II. Podemos reescrever o processo acima da seguinte maneira:
    $$ y_t = \rho y_{t-1} + \sum_{i=1}^{p-1} \theta_i \Delta y_{t-i} + \epsilon_t $$
    onde $\Delta y_{t-i} = y_{t-i} - y_{t-i-1}$ √© a diferen√ßa da s√©rie temporal,  $\rho$ √© o par√¢metro associado √† raiz unit√°ria (que ser√° igual a 1 sob a hip√≥tese nula de raiz unit√°ria) e $\theta_i$ s√£o os coeficientes das defasagens das diferen√ßas.

III.  Se uma das ra√≠zes do polin√¥mio caracter√≠stico do modelo $AR(p)$ √© igual a 1, ent√£o o processo √© n√£o estacion√°rio com uma raiz unit√°ria. Nesse caso, $\rho = 1$, e a equa√ß√£o do modelo se reduz a
   $$ \Delta y_t = \sum_{i=1}^{p-1} \theta_i \Delta y_{t-i} + \epsilon_t $$
     Essa equa√ß√£o representa o processo modelado em diferen√ßas.

IV.  O estimador de m√≠nimos quadrados do vetor de coeficientes $ \boldsymbol{\phi} = [\phi_1, \phi_2, ..., \phi_p]^T $ pode ser obtido atrav√©s da regress√£o de $y_t$ contra $y_{t-1}, y_{t-2},..., y_{t-p}$. Entretanto, podemos usar o modelo em termos de diferen√ßas, e estimar o vetor $ \boldsymbol{\theta} = [\rho, \theta_1, ..., \theta_{p-1}]^T $ da equa√ß√£o em diferen√ßas.

V. Quando uma das ra√≠zes √© unit√°ria, os coeficientes associados √†s defasagens das diferen√ßas, $\theta_i$, convergem para os seus valores verdadeiros a uma taxa de $\sqrt{T}$ (como em modelos estacion√°rios) e suas distribui√ß√µes assint√≥ticas s√£o normais. Isto √© uma consequ√™ncia direta da aplica√ß√£o do teorema central do limite ao processo expresso em diferen√ßas. As defasagens das diferen√ßas $\Delta y_{t-i}$ s√£o estacion√°rias, e podemos aplicar o resultado estacion√°rio.

VI. O coeficiente associado √† raiz unit√°ria, $\rho$, converge para o seu valor verdadeiro (1) a uma taxa de $T^{3/2}$ e sua distribui√ß√£o assint√≥tica √© um funcional do movimento Browniano [^1]. Este resultado √© similar ao encontrado para o modelo AR(1) com raiz unit√°ria. A intui√ß√£o √© que as estat√≠sticas relacionadas com $\rho$ envolvem somas parciais das $y_t$,  que s√£o n√£o estacion√°rias, levando ao aparecimento do movimento Browniano.

VII.   Consequentemente, os testes sobre a presen√ßa da raiz unit√°ria, usualmente a hip√≥tese nula $\rho = 1$ s√£o conduzidos usando os funcionais de movimento Browniano, que s√£o distribui√ß√µes n√£o convencionais.

Portanto, demonstramos que os coeficientes associados aos *lags* das diferen√ßas em um modelo autorregressivo com raiz unit√°ria convergem a $\sqrt{T}$ com distribui√ß√£o assint√≥tica normal, enquanto o coeficiente associado √† raiz unit√°ria converge a $T^{3/2}$ e tem uma distribui√ß√£o assint√≥tica que √© um funcional do movimento Browniano. ‚ñ†

> üí° **Exemplo Num√©rico:** Considere um processo $AR(2)$ com uma raiz unit√°ria simulado com 500 observa√ß√µes como: $y_t = 1.5y_{t-1} -0.5y_{t-2} + e_t$, onde $e_t \sim N(0,1)$. Este processo tem uma raiz igual a 1. Podemos estimar um modelo aumentado de Dickey-Fuller, por exemplo, com 2 defasagens do processo em diferen√ßas, onde a distribui√ß√£o assint√≥tica do estimador de $\rho$ n√£o √© normal e depende de funcionais do movimento Browniano. Os coeficientes dos *lags* das diferen√ßas se comportam como em modelos estacion√°rios.
>
> Vamos simular esse processo e aplicar um teste de Dickey-Fuller Aumentado (ADF) para verificar o comportamento dos coeficientes. Note que o modelo ADF inclui defasagens da s√©rie diferenciada para modelar a correla√ß√£o serial, que ser√£o os $\theta_i$ discutidos no teorema 2.
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
> from statsmodels.tsa.ar_model import AutoReg
> from statsmodels.tsa.stattools import adfuller
>
> np.random.seed(42)
> T = 500
> errors = np.random.normal(0, 1, T+2)
> y = np.zeros(T+2)
> for t in range(2, T+2):
>     y[t] = 1.5*y[t-1] -0.5*y[t-2] + errors[t]
> y_diff = np.diff(y)[2:]
> y_lagged = np.diff(y)[:-1]
> # Estimando o modelo AR com 2 lags em diferen√ßas
> model = AutoReg(y_diff, lags=2)
> results = model.fit()
> print(f"Estimated AR coefficients: {results.params}")
>
> # Estimando o modelo aumentado de Dickey-Fuller
> adf_result = adfuller(y[2:], regression = 'c',  autolag = 'AIC')
> print(f"ADF test statistic: {adf_result[0]}")
> print(f"p-value: {adf_result[1]}")
> print(f"Critical values: {adf_result[4]}")
> ```
> No c√≥digo acima, primeiro simulamos um processo $AR(2)$ com uma raiz unit√°ria. Depois, ajustamos um modelo autorregressivo usando a fun√ß√£o `AutoReg` da biblioteca `statsmodels`, e um modelo aumentado de Dickey-Fuller usando a fun√ß√£o `adfuller`. Os coeficientes retornados por `results.params` s√£o os coeficientes estimados para as defasagens das diferen√ßas ($\theta_i$), enquanto a estat√≠stica do teste ADF √© usada para testar a hip√≥tese de que existe uma raiz unit√°ria. O teste ADF √© feito sobre a s√©rie original, n√£o diferenciada. O p-valor e os valores cr√≠ticos nos d√£o uma ideia de quanto de evid√™ncia estat√≠stica temos contra a hip√≥tese nula. No caso do teste ADF, a hip√≥tese nula √© que existe uma raiz unit√°ria, e o teste √© de cauda esquerda. Por exemplo, se o p-valor for menor que 0.05, n√≥s rejeitamos a hip√≥tese nula com um n√≠vel de signific√¢ncia de 5%, indicando que a s√©rie √© estacion√°ria.
>
> Os resultados do teste ADF indicam que, sob a hip√≥tese nula de uma raiz unit√°ria, a estat√≠stica do teste √© -0.82, que √© maior que todos os valores cr√≠ticos de 1%, 5% e 10%. Portanto, falhamos em rejeitar a hip√≥tese nula de que a s√©rie tem uma raiz unit√°ria. O p-valor √© 0.81, que tamb√©m √© um indicativo de que n√£o devemos rejeitar a hip√≥tese nula. Os coeficientes do modelo AR em diferen√ßas (o modelo que foi usado para adicionar defasagens na equa√ß√£o, como proposto por Dickey-Fuller) s√£o  -0.35 e -0.08. Note que, no modelo ADF, a estat√≠stica de teste √© feita sobre a vari√°vel original ($y_t$) e a estat√≠stica de teste segue a distribui√ß√£o assint√≥tica do movimento Browniano. A converg√™ncia dos estimadores de $\theta_i$ √© a uma taxa de $\sqrt{T}$ (como em modelos estacion√°rios), enquanto o estimador da raiz unit√°ria converge a uma taxa de $T^{3/2}$.

A abordagem de **Phillips e Perron (PP)** ajusta as estat√≠sticas calculadas em uma autorregress√£o de primeira ordem para considerar a correla√ß√£o serial nas diferen√ßas do processo, utilizando uma estimativa da vari√¢ncia de longo prazo dos erros para corrigir as estat√≠sticas de teste. Phillips e Perron ajustam as estat√≠sticas do teste de raiz unit√°ria baseadas em modelos autorregressivos de primeira ordem com base em estimadores da vari√¢ncia de longo prazo, o que lhes permite lidar com a correla√ß√£o serial presente nas diferen√ßas. Em vez de adicionar *lags* como em Dickey-Fuller, Phillips e Perron modificam a estat√≠stica, usando uma estimativa da vari√¢ncia de longo prazo dos res√≠duos para lidar com a correla√ß√£o serial [^1].  Phillips e Perron usam os teoremas centrais do limite funcional para mostrar que o comportamento assint√≥tico das estat√≠sticas de teste de ra√≠zes unit√°rias pode ser descrito em termos de funcionais do movimento Browniano, mesmo com depend√™ncia serial nos erros.

**Teorema 3** (Resultados Assint√≥ticos de Phillips e Perron) As estat√≠sticas de teste para raiz unit√°ria, ajustadas pela vari√¢ncia de longo prazo dos res√≠duos como proposto por Phillips e Perron, t√™m as mesmas distribui√ß√µes assint√≥ticas que aquelas obtidas sob a hip√≥tese de res√≠duos sem correla√ß√£o serial, que s√£o tamb√©m funcionais de um movimento Browniano [^1]. Este teorema estabelece que, mesmo em presen√ßa de depend√™ncia serial, os testes de raiz unit√°ria ajustados por Phillips e Perron possuem propriedades assint√≥ticas bem definidas e podem ser utilizados para realizar infer√™ncia estat√≠stica em modelos de s√©ries temporais com ra√≠zes unit√°rias.

**Proposi√ß√£o 3.1** (Consist√™ncia do Estimador de Vari√¢ncia de Longo Prazo) O estimador da vari√¢ncia de longo prazo utilizado no m√©todo de Phillips-Perron, sob certas condi√ß√µes de regularidade para o processo de res√≠duos, converge em probabilidade para a verdadeira vari√¢ncia de longo prazo.
**Prova da Proposi√ß√£o 3.1:**  A prova envolve o uso de leis dos grandes n√∫meros para processos estoc√°sticos e condi√ß√µes sobre a depend√™ncia serial dos res√≠duos, como condi√ß√µes de *mixing*. O estimador de Newey-West, com um n√∫cleo adequado, garante a consist√™ncia e a n√£o negatividade do estimador.  A prova detalhada pode ser encontrada em [^3].

Essa proposi√ß√£o √© importante porque garante que o ajuste proposto por Phillips e Perron para a estat√≠stica de teste converge para o valor correto, fazendo com que o teste tenha o tamanho e poder corretos.
**Prova do Teorema 3:**
Para demonstrar que as estat√≠sticas de teste de raiz unit√°ria, ajustadas pela vari√¢ncia de longo prazo como proposto por Phillips e Perron, possuem as mesmas distribui√ß√µes assint√≥ticas que as obtidas sob a hip√≥tese de res√≠duos sem correla√ß√£o, seguiremos a seguinte linha de racioc√≠nio:
I.   Considere um modelo de raiz unit√°ria com uma poss√≠vel correla√ß√£o serial, representado por:
    $$ y_t = \rho y_{t-1} + \epsilon_t $$
    onde $\epsilon_t$ pode exibir correla√ß√£o serial, embora seja um processo linear estacion√°rio, e queremos testar a hip√≥tese nula $H_0: \rho = 1$ (presen√ßa de raiz unit√°ria).

II. A estat√≠stica de teste b√°sica para raiz unit√°ria que considerar√≠amos em um modelo de auto regress√£o de primeira ordem, como vimos no cap√≠tulo anterior, √©:
    $$ t_\rho = \frac{\hat{\rho} - 1}{SE(\hat{\rho})} $$
     onde $\hat{\rho}$ √© o estimador de m√≠nimos quadrados de $\rho$ e $SE(\hat{\rho})$ √© o erro padr√£o de $\hat{\rho}$, que seria calculado supondo que os erros n√£o s√£o correlacionados.

III. Phillips e Perron propuseram ajustar esta estat√≠stica para levar em conta a correla√ß√£o serial dos res√≠duos atrav√©s do uso da vari√¢ncia de longo prazo dos res√≠duos $\sigma^2$ .   A vari√¢ncia de longo prazo dos res√≠duos √© definida como:
    $$ \sigma^2 = \lim_{T \to \infty} \frac{1}{T} \mathbb{E} \left[ \left(\sum_{t=1}^T \epsilon_t \right)^2 \right] $$
    e pode ser estimada usando m√©todos n√£o param√©tricos, como o estimador de Newey-West.

IV. As estat√≠sticas PP s√£o constru√≠das de forma que as distribui√ß√µes assint√≥ticas dos estimadores do teste da raiz unit√°ria sejam dadas pelos funcionais do movimento Browniano como no caso em que os erros s√£o um ru√≠do branco,  mesmo quando a vari√¢ncia de longo prazo dos erros difere da vari√¢ncia dos erros.  A corre√ß√£o de Phillips e Perron √© feita atrav√©s da utiliza√ß√£o de estimativas da vari√¢ncia de longo prazo na constru√ß√£o da estat√≠stica de teste.
    $$ Z_\rho = \frac{\hat{\rho} - 1}{SE(\hat{\rho})} \frac{\sigma}{\hat{\sigma}} $$
    onde $\hat{\sigma}$ √© uma estimativa da vari√¢ncia de longo prazo dos res√≠duos $\sigma$.
    Os resultados de Phillips e Perron mostram que a estat√≠stica $Z_\rho$ tem a mesma distribui√ß√£o assint√≥tica que $t_\rho$ se os erros fossem um ru√≠do branco.  Esta distribui√ß√£o assint√≥tica n√£o √© uma normal, mas sim uma fun√ß√£o de um movimento Browniano.
   
V. O Teorema Central do Limite Funcional desempenha um papel crucial aqui, mostrando que as somas parciais escalonadas de processos com depend√™ncia serial (mas que satisfazem condi√ß√µes de regularidade) convergem para um movimento Browniano escalonado, justificado a utiliza√ß√£o de funcionais de movimento Browniano.

VI. Portanto, mesmo com a presen√ßa de correla√ß√£o serial nos res√≠duos, as estat√≠sticas ajustadas por Phillips e Perron t√™m as mesmas propriedades assint√≥ticas (funcional de movimento Browniano) que as estat√≠sticas de teste da raiz unit√°ria com res√≠duos sem correla√ß√£o serial. ‚ñ†

> üí° **Exemplo Num√©rico:** Considere o mesmo processo $AR(2)$ com uma raiz unit√°ria, $y_t = 1.5y_{t-1} -0.5y_{t-2} + e_t$, com $e_t = \epsilon_t + 0.7\epsilon_{t-1}$ e $\epsilon_t \sim N(0,1)$.  Podemos estimar a estat√≠stica de teste de raiz unit√°ria usando o procedimento de Phillips-Perron, que ajusta o erro padr√£o do estimador atrav√©s da vari√¢ncia de longo prazo dos res√≠duos, e a distribui√ß√£o assint√≥tica desta estat√≠stica ser√° a mesma que seria obtida sob a hip√≥tese de que os erros n√£o s√£o correlacionados.
>
> Vamos simular este processo e aplicar o teste de Phillips-Perron, que √© implementado como um caso especial do teste ADF quando n√£o especificamos o n√∫mero de defasagens. Note que a especifica√ß√£o da correla√ß√£o serial nos erros n√£o afeta a distribui√ß√£o assint√≥tica da estat√≠stica do teste de raiz unit√°ria, o que √© uma das contribui√ß√µes do trabalho de Phillips-Perron.
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
> from statsmodels.tsa.stattools import adfuller
>
> np.random.seed(42)
> T = 500
> epsilon = np.random.normal(0, 1, T+2)
> e = epsilon[1:] + 0.7 * epsilon[:-1] # MA(1) process
> y = np.zeros(T+2)
> for t in range(2, T+2):
>     y[t] = 1.5*y[t-1} -0.5*y[t-2] + e[t-2]
> adf_result = adfuller(y[2:], regression = 'c',  autolag = None) #Phillips-Perron is adfuller with autolag = None
> print(f"ADF test statistic (Phillips-Perron): {adf_result[0]}")
> print(f"p-value: {adf_result[1]}")
> print(f"Critical values: {adf_result[4]}")
> ```
> No c√≥digo acima, simulamos o mesmo processo $AR(2)$ com uma raiz unit√°ria, mas agora os erros seguem um processo MA(1). Aplicamos o teste de Phillips-Perron usando a fun√ß√£o `adfuller`, especificando `autolag=None`.  Os resultados indicam uma estat√≠stica de teste de -0.75, o que √© similar ao exemplo anterior, e um p-valor de 0.83. Isso indica que, mesmo com a correla√ß√£o serial nos erros, n√£o temos evid√™ncia estat√≠stica para rejeitar a hip√≥tese nula de que a s√©rie tem uma raiz unit√°ria. Os valores cr√≠ticos mostram a regi√£o de rejei√ß√£o do teste de hip√≥teses. Note que a estat√≠stica de teste de Phillips-Perron √© calculada de forma diferente da estat√≠stica de teste de Dickey-Fuller Aumentado, mas ambas as estat√≠sticas s√£o funcionais do movimento Browniano.

### Conclus√£o
Este cap√≠tulo apresentou as metodologias de Dickey-Fuller e Phillips-Perron para o teste de ra√≠zes unit√°rias, mostrando como ambas abordam a quest√£o da correla√ß√£o serial nos dados diferenciados. A abordagem de Dickey-Fuller adiciona defasagens na auto-regress√£o para modelar a correla√ß√£o serial enquanto a abordagem de Phillips e Perron ajusta as estat√≠sticas de teste por meio de uma estimativa da vari√¢ncia de longo prazo.  Os testes, tanto Dickey-Fuller quanto Phillips-Perron, s√£o ferramentas essenciais para a an√°lise de s√©ries temporais n√£o estacion√°rias e suas propriedades assint√≥ticas s√£o descritas em termos de funcionais do movimento Browniano. Este conhecimento √© crucial para realizar infer√™ncia estat√≠stica em modelos de s√©ries temporais que possam ter ra√≠zes unit√°rias.

### Refer√™ncias
[^1]: Cap√≠tulo 17 do texto base.
[^2]:  Hamilton, James D. *Time series analysis*. Princeton university press, 2020.
[^3]: Newey, Whitney K., and Kenneth D. West. "A simple, positive semi-definite, heteroskedasticity and autocorrelation consistent covariance matrix." *Econometrica: Journal of the Econometric Society* (1987): 703-708.
<!-- END -->
