## MÃ©tricas de Erro para AvaliaÃ§Ã£o da PrecisÃ£o da PrevisÃ£o em SÃ©ries Temporais

### IntroduÃ§Ã£o
Como abordado nos capÃ­tulos anteriores, a modelagem de sÃ©ries temporais envolve a anÃ¡lise de dados sequenciais ao longo do tempo para fins de previsÃ£o [^5]. A precisÃ£o da previsÃ£o Ã© um componente crÃ­tico desta anÃ¡lise, pois quantifica a eficÃ¡cia de um determinado modelo de previsÃ£o [^10]. Neste capÃ­tulo, expandimos a discussÃ£o sobre a avaliaÃ§Ã£o da precisÃ£o da previsÃ£o, focando nas trÃªs medidas mais comuns utilizadas para quantificar erros em modelos de sÃ©ries temporais: o Desvio Absoluto MÃ©dio (MAD), o Erro QuadrÃ¡tico MÃ©dio (MSE) e o Erro Percentual Absoluto MÃ©dio (MAPE), adicionando tambÃ©m a anÃ¡lise do Erro MÃ©dio Absoluto Escalonado (MASE) e da Raiz do Erro QuadrÃ¡tico MÃ©dio (RMSE). O erro de previsÃ£o, essencialmente a diferenÃ§a entre a demanda real e o valor previsto [^9], Ã© a base dessas mÃ©tricas. A escolha da mÃ©trica mais adequada Ã© crucial, pois cada uma oferece diferentes perspectivas sobre a precisÃ£o da previsÃ£o, como discutido anteriormente [^10].

### Conceitos Fundamentais
A avaliaÃ§Ã£o da precisÃ£o da previsÃ£o Ã© essencial para determinar a confiabilidade de um modelo, utilizando mÃ©tricas que quantificam a magnitude e o tipo de erro de previsÃ£o. O erro de previsÃ£o Ã© definido como a diferenÃ§a entre a demanda real e a previsÃ£o [^9]. Matematicamente, isso pode ser expresso como:

$$ \text{Erro de PrevisÃ£o} = \text{Demanda Real} - \text{PrevisÃ£o} $$ [^9]

Como as previsÃµes sÃ£o para o futuro, o erro Ã© computado utilizando dados histÃ³ricos para avaliar a adequaÃ§Ã£o da abordagem de previsÃ£o [^10].

#### Medidas de Erro de PrevisÃ£o
VÃ¡rias mÃ©tricas sÃ£o utilizadas para avaliar a precisÃ£o da previsÃ£o. Nesta seÃ§Ã£o, iremos aprofundar nas trÃªs mÃ©tricas mais comuns: MAD, MSE e MAPE, alÃ©m de introduzir o RMSE e o MASE.

1.  **Desvio Absoluto MÃ©dio (MAD):** O MAD mede a magnitude mÃ©dia do erro de previsÃ£o em unidades absolutas. Ele representa a mÃ©dia das diferenÃ§as absolutas entre os valores previstos e os valores reais [^10]. A fÃ³rmula para o MAD Ã© dada por:
    $$ \text{MAD} = \frac{\sum |\text{Demanda Real} - \text{PrevisÃ£o}|}{n} $$ [^10]
    onde *n* representa o nÃºmero de perÃ­odos incluÃ­dos no cÃ¡lculo [^10]. O MAD fornece uma visÃ£o geral da magnitude do erro, sem levar em conta a direÃ§Ã£o do erro.
     > ğŸ’¡ **Exemplo NumÃ©rico:**
      > Consideremos uma sÃ©rie temporal e suas previsÃµes:
      >
      > | PerÃ­odo | Demanda Real ($y_t$) | PrevisÃ£o ($\hat{y}_t$) |
      > |---|---|---|
      > | 1 | 100 | 110 |
      > | 2 | 120 | 115 |
      > | 3 | 130 | 125 |
      > | 4 | 150 | 140 |
      > | 5 | 160 | 155 |
      >
      > $\text{Step 1: Calcular os erros absolutos: }$
      >
      > $|100-110| = 10$
      > $|120-115| = 5$
      > $|130-125| = 5$
      > $|150-140| = 10$
      > $|160-155| = 5$
      >
      > $\text{Step 2: Calcular a mÃ©dia dos erros absolutos: }$
      >
      > $\text{MAD} = \frac{10 + 5 + 5 + 10 + 5}{5} = \frac{35}{5} = 7$
      >
      > Um MAD de 7 significa que, em mÃ©dia, as previsÃµes estÃ£o a 7 unidades da demanda real.
      >
      > ```python
      > import numpy as np
      >
      > actual_demand = np.array([100, 120, 130, 150, 160])
      > forecast = np.array([110, 115, 125, 140, 155])
      >
      > absolute_errors = np.abs(actual_demand - forecast)
      > mad = np.mean(absolute_errors)
      > print(f"MAD: {mad}")
      > ```

2.  **Erro QuadrÃ¡tico MÃ©dio (MSE):** O MSE mede a mÃ©dia dos quadrados dos erros de previsÃ£o. Ele penaliza erros maiores mais severamente do que erros menores [^12]. A fÃ³rmula para MSE Ã©:

    $$ \text{MSE} = \frac{\sum (\text{Demanda Real} - \text{PrevisÃ£o})^2}{n} $$ [^12]

    onde *n* Ã© o nÃºmero de perÃ­odos considerados.
    
      > ğŸ’¡ **Exemplo NumÃ©rico:** Usando os mesmos dados do exemplo do MAD, o MSE Ã© calculado da seguinte forma:
      >
      > $\text{Step 1: Calcular os erros ao quadrado: }$
      >
      > $(100-110)^2 = (-10)^2 = 100$
      > $(120-115)^2 = (5)^2 = 25$
      > $(130-125)^2 = (5)^2 = 25$
      > $(150-140)^2 = (10)^2 = 100$
      > $(160-155)^2 = (5)^2 = 25$
      >
      > $\text{Step 2: Calcular a mÃ©dia dos erros ao quadrado: }$
      >
      > $\text{MSE} = \frac{100 + 25 + 25 + 100 + 25}{5} = \frac{275}{5} = 55$
      >
      > O MSE Ã© 55.
      > ```python
      > squared_errors = (actual_demand - forecast) ** 2
      > mse = np.mean(squared_errors)
      > print(f"MSE: {mse}")
      > ```

  **2.1 Raiz do Erro QuadrÃ¡tico MÃ©dio (RMSE):** O RMSE Ã© a raiz quadrada do MSE, retornando o erro na mesma unidade dos dados originais, o que facilita a interpretaÃ§Ã£o. Ã‰ dado por:

      $$ \text{RMSE} = \sqrt{\frac{\sum (\text{Demanda Real} - \text{PrevisÃ£o})^2}{n}} = \sqrt{MSE} $$

     > ğŸ’¡ **Exemplo NumÃ©rico:** Usando o MSE calculado anteriormente, o RMSE Ã©:
     >
     > $\text{RMSE} = \sqrt{55} \approx 7.42$
     >
     > O RMSE Ã© de aproximadamente 7.42, o que estÃ¡ na mesma escala de unidade dos dados. O RMSE Ã© particularmente Ãºtil quando desejamos avaliar os erros de previsÃ£o na mesma unidade que os dados originais, e mantÃ©m a penalizaÃ§Ã£o para grandes erros do MSE.
     >
     > ```python
     > rmse = np.sqrt(mse)
     > print(f"RMSE: {rmse}")
     > ```
    
    **Lema 2.1:** O RMSE Ã© sempre maior ou igual ao MAD para um mesmo conjunto de previsÃµes.
    
    **Prova:** Pela desigualdade de Cauchy-Schwarz, para quaisquer nÃºmeros reais $a_i$ e $b_i$, temos:
    
    $$ \left(\sum_{i=1}^n a_i b_i\right)^2 \leq \left(\sum_{i=1}^n a_i^2\right) \left(\sum_{i=1}^n b_i^2\right) $$
    
    I. Seja $a_i = |y_i - \hat{y}_i|$ e $b_i = 1$. EntÃ£o:
    
    $$ \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2 \leq \left(\sum_{i=1}^n |y_i - \hat{y}_i|^2\right) \left(\sum_{i=1}^n 1^2\right) $$
    
    II. Simplificando, temos:
    
    $$ \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2 \leq n \sum_{i=1}^n (y_i - \hat{y}_i)^2 $$
    
   III. Dividindo ambos os lados por $n^2$ e tomando a raiz quadrada:
    
     $$ \sqrt{\frac{1}{n^2} \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2} \leq \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2} $$
    
    IV. Simplificando a expressÃ£o, temos:
    
    $$ \frac{1}{n} \sum_{i=1}^n |y_i - \hat{y}_i| \leq \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2} $$
    
    V. Reconhecendo as fÃ³rmulas de MAD e RMSE, chegamos a:
    
    $$ MAD \leq RMSE $$
    
    A igualdade ocorre apenas se todos os erros absolutos forem iguais. $\blacksquare$
   
3. **Erro Percentual Absoluto MÃ©dio (MAPE):** O MAPE expressa o erro como uma porcentagem da demanda real. Isso resolve o problema da dependÃªncia do volume encontrado no MAD e no MSE [^12]. O MAPE Ã© calculado como:
    $$ \text{MAPE} = \frac{\sum \left|\frac{\text{Demanda Real} - \text{PrevisÃ£o}}{\text{Demanda Real}}\right|}{n} \times 100 $$ [^12]
     Um MAPE de 13,19%, por exemplo, indica que, em mÃ©dia, as previsÃµes do modelo de suavizaÃ§Ã£o exponencial com Î±=0,4 desviam 13,19% da demanda real [^12].

      > ğŸ’¡ **Exemplo NumÃ©rico:** Usando os mesmos dados, o MAPE Ã© calculado como:
      >
      > $\text{Step 1: Calcular os erros percentuais absolutos: }$
      >
      > $|\frac{100-110}{100}| = |-\frac{10}{100}| = 0.10$
      > $|\frac{120-115}{120}| = |\frac{5}{120}| = 0.0417$
      > $|\frac{130-125}{130}| = |\frac{5}{130}| = 0.0385$
      > $|\frac{150-140}{150}| = |\frac{10}{150}| = 0.0667$
      > $|\frac{160-155}{160}| = |\frac{5}{160}| = 0.0313$
      >
      > $\text{Step 2: Calcular a mÃ©dia dos erros percentuais absolutos e multiplicar por 100: }$
      >
      > $\text{MAPE} = \frac{0.10 + 0.0417 + 0.0385 + 0.0667 + 0.0313}{5} \times 100 = \frac{0.2782}{5} \times 100 = 0.05564 \times 100 = 5.564\%$
      >
      > O MAPE Ã© de aproximadamente 5.564%, indicando que, em mÃ©dia, as previsÃµes estÃ£o cerca de 5.564% da demanda real.
      >
      > ```python
      > absolute_percentage_errors = np.abs((actual_demand - forecast) / actual_demand)
      > mape = np.mean(absolute_percentage_errors) * 100
      > print(f"MAPE: {mape:.3f}%")
      > ```
    
    **ProposiÃ§Ã£o 3.1:** O MAPE pode gerar valores indefinidos se a demanda real em algum perÃ­odo for zero.
    
    **Prova:**
    
    I. A fÃ³rmula do MAPE Ã©:
    $$ \text{MAPE} = \frac{\sum \left|\frac{\text{Demanda Real} - \text{PrevisÃ£o}}{\text{Demanda Real}}\right|}{n} \times 100 $$
    
    II. A fÃ³rmula envolve a divisÃ£o da diferenÃ§a entre a demanda real e a previsÃ£o pela demanda real em cada perÃ­odo: $\frac{\text{Demanda Real} - \text{PrevisÃ£o}}{\text{Demanda Real}}$.
    
    III. Se em algum perÃ­odo a demanda real for zero, a operaÃ§Ã£o de divisÃ£o torna-se $\frac{\text{Demanda Real} - \text{PrevisÃ£o}}{0}$, que Ã© indefinida.
    
    IV. Portanto, o MAPE nÃ£o Ã© definido para sÃ©ries temporais onde a demanda real em algum perÃ­odo Ã© zero. $\blacksquare$
    
    **ObservaÃ§Ã£o 3.2:** Pequenas variaÃ§Ãµes na demanda real, especialmente quando prÃ³ximos a zero, podem causar grandes flutuaÃ§Ãµes no MAPE, tornando-o instÃ¡vel nessas circunstÃ¢ncias.

4.  **Erro MÃ©dio Absoluto Escalonado (MASE):** O MASE Ã© Ãºtil para comparar modelos preditivos com um modelo *naive* (usualmente, o valor do perÃ­odo anterior), e resolve as limitaÃ§Ãµes do MAPE quando a demanda Ã© prÃ³xima de zero. A fÃ³rmula para o MASE Ã©:
    $$ \text{MASE} = \frac{\frac{1}{n} \sum_{t=1}^{n} |y_t - \hat{y}_t|}{\frac{1}{n-1}\sum_{t=2}^{n}|y_t - y_{t-1}|} $$
    onde $y_t$ Ã© a demanda real, $\hat{y}_t$ Ã© a previsÃ£o, e *n* Ã© o nÃºmero de perÃ­odos. O denominador Ã© o MAD de um modelo *naÃ¯ve*, enquanto o numerador Ã© o MAD do modelo avaliado.  Um MASE menor que 1 indica um modelo mais preciso que o *naÃ¯ve*.
     > ğŸ’¡ **Exemplo NumÃ©rico:** Utilizando novamente os mesmos dados, e adicionando um valor anterior para calcular o denominador do MASE, temos:
     >
     > | PerÃ­odo | Demanda Real ($y_t$) | PrevisÃ£o ($\hat{y}_t$) |
     > |---|---|---|
     > | 0 | 90| - |
     > | 1 | 100 | 110 |
     > | 2 | 120 | 115 |
     > | 3 | 130 | 125 |
     > | 4 | 150 | 140 |
     > | 5 | 160 | 155 |
     >
     >
     > $\text{Step 1: Calcular o numerador (MAD do modelo): }$
     >
     > JÃ¡ calculamos o MAD no primeiro exemplo, que Ã© 7. Logo, o numerador Ã© igual a 7.
     >
     > $\text{Step 2: Calcular o denominador (MAD do modelo naive): }$
     >
     > $|100-90| = 10$
     > $|120-100| = 20$
     > $|130-120| = 10$
     > $|150-130| = 20$
     > $|160-150| = 10$
     >
     > $\text{Denominador} = \frac{10 + 20 + 10 + 20 + 10}{5-1} = \frac{70}{4} = 17.5$
     >
     > $\text{Step 3: Calcular o MASE: }$
     >
     > $\text{MASE} = \frac{7}{17.5} \approx 0.4$
     >
     > Como o MASE Ã© menor que 1, nosso modelo Ã© mais preciso do que o modelo *naive*.
     >
     > ```python
     > actual_demand_with_prev = np.array([90, 100, 120, 130, 150, 160])
     > naive_forecast_errors = np.abs(actual_demand_with_prev[1:] - actual_demand_with_prev[:-1])
     > mase_denominator = np.mean(naive_forecast_errors)
     > mase = mad / mase_denominator
     > print(f"MASE: {mase:.3f}")
     > ```
    
#### Escolha do Modelo Adequado
A escolha do modelo apropriado e das mÃ©tricas de avaliaÃ§Ã£o de precisÃ£o depende do objetivo da anÃ¡lise. Modelos com maior capacidade de resposta, como WMA e suavizaÃ§Ã£o exponencial com Î± alto, tendem a oferecer maior precisÃ£o para alguns dados histÃ³ricos [^12].

**Lema 1:** A seleÃ§Ã£o da mÃ©trica de erro apropriada depende do objetivo principal da anÃ¡lise. O MAD, por exemplo, Ã© apropriado quando o foco Ã© entender a magnitude mÃ©dia dos erros de previsÃ£o em termos absolutos da variÃ¡vel. Se a penalizaÃ§Ã£o de grandes erros for importante, o MSE ou RMSE sÃ£o mais adequados. O MAPE Ã© adequado quando o objetivo Ã© expressar o erro como uma porcentagem, contanto que a demanda nÃ£o seja prÃ³xima de zero. Nesses casos, o MASE pode ser uma melhor escolha.
> ğŸ’¡ **Exemplo Comparativo:**
> Para ilustrar a importÃ¢ncia da escolha da mÃ©trica de avaliaÃ§Ã£o de erros, vejamos um exemplo com dois modelos preditivos para a mesma sÃ©rie temporal:
>
> | Modelo | MAD | MSE | RMSE | MAPE (%) | MASE |
> |---|---|---|---|---|---|
> | Modelo 1 | 7 | 55 | 7.42 | 5.56 | 0.4 |
> | Modelo 2 | 10 | 120 | 10.95 | 7.00 | 0.6 |
>
> O Modelo 1 tem um MAD, MSE, RMSE e MAPE menores do que o Modelo 2. Isso indica que o Modelo 1 apresenta menor magnitude de erros e penaliza menos os grandes erros, com um menor erro em termos percentuais e um melhor desempenho do que um modelo *naive*. Para este exemplo, todas as mÃ©tricas estÃ£o de acordo na avaliaÃ§Ã£o de que o Modelo 1 Ã© mais preciso para esta sÃ©rie temporal. A escolha da mÃ©trica deve se alinhar aos objetivos especÃ­ficos da anÃ¡lise: priorizar MAD se o foco for o erro mÃ©dio, MSE e RMSE para grandes erros, MAPE para valores relativos, e MASE se a demanda for prÃ³xima a zero.
>
> ```python
> import pandas as pd
> data = {'Modelo': ['Modelo 1', 'Modelo 2'],
>         'MAD': [7, 10],
>         'MSE': [55, 120],
>         'RMSE': [7.42, 10.95],
>         'MAPE (%)': [5.56, 7.00],
>         'MASE': [0.4, 0.6]}
> df = pd.DataFrame(data)
> print(df)
> ```

### ConclusÃ£o
A avaliaÃ§Ã£o da precisÃ£o da previsÃ£o Ã© um aspecto fundamental na modelagem de sÃ©ries temporais. Este capÃ­tulo explorou as trÃªs mÃ©tricas mais comuns para quantificar os erros de previsÃ£o, MAD, MSE, MAPE, alÃ©m de introduzir o RMSE e o MASE.  Cada mÃ©trica oferece uma perspectiva Ãºnica sobre a precisÃ£o da previsÃ£o, destacando a importÃ¢ncia de escolher a mÃ©trica mais adequada de acordo com as necessidades do problema em questÃ£o.  A escolha do modelo e da mÃ©trica de avaliaÃ§Ã£o devem ser baseadas na necessidade do negÃ³cio, tendo em mente que diferentes mÃ©tricas podem convergir para um mesmo resultado, como vimos no exemplo comparativo. No final, a capacidade de avaliar a precisÃ£o da previsÃ£o Ã© fundamental para escolher o melhor modelo e, consequentemente, melhorar o planejamento e a alocaÃ§Ã£o de recursos [^23].

### ReferÃªncias
[^5]: *Time series models assume that past demand data are representative of future demand.*
[^9]: *Forecast error = Actual demand - Forecast.*
[^10]: *Because a forecast predicts future demand, we cannot compare it to actual demand. However, because we have assumed that historical demand is representative of future demand, we can formulate "forecasts of the past" using a particular model and compare those forecasts to historical demand.*
[^12]: *With both the MAD and MSE, the size of the deviations depends on the volume of the item being forecast. For example, if the demand is in thousands of units, the absolute and squared deviations could be quite large. The mean absolute percentage error (MAPE) remedies this problem by expressing the deviation as a percentage of the actual demand.*
[^15]: *Exponential smoothing (ES) is one of the most popular forecasting techniques. It is similar to a WMA technique in the sense that it assigns (a) a weight between 0 and 1 (called the "smoothing constant"), a, to the actual demand in the previous period and (b) a weight (1 â€“ a) to the exponential smoothing forecast for the previous period*
[^19]: *In a time series, seasonality is expressed as the amount of deviation between the actual demand values and the average value of the series.*
[^23]: *Forecasting demand is important to be able to plan and allocate the resources necessary to provide uninterrupted, quality customer service and avoid the excess costs arising from mismatched demand and supply.*
<!-- END -->
