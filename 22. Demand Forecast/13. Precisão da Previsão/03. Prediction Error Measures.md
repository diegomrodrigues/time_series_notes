## M√©tricas de Erro para Avalia√ß√£o da Precis√£o da Previs√£o em S√©ries Temporais

### Introdu√ß√£o
Como abordado nos cap√≠tulos anteriores, a modelagem de s√©ries temporais envolve a an√°lise de dados sequenciais ao longo do tempo para fins de previs√£o [^5]. A precis√£o da previs√£o √© um componente cr√≠tico desta an√°lise, pois quantifica a efic√°cia de um determinado modelo de previs√£o [^10]. Neste cap√≠tulo, expandimos a discuss√£o sobre a avalia√ß√£o da precis√£o da previs√£o, focando nas tr√™s medidas mais comuns utilizadas para quantificar erros em modelos de s√©ries temporais: o Desvio Absoluto M√©dio (MAD), o Erro Quadr√°tico M√©dio (MSE) e o Erro Percentual Absoluto M√©dio (MAPE), adicionando tamb√©m a an√°lise do Erro M√©dio Absoluto Escalonado (MASE) e da Raiz do Erro Quadr√°tico M√©dio (RMSE). O erro de previs√£o, essencialmente a diferen√ßa entre a demanda real e o valor previsto [^9], √© a base dessas m√©tricas. A escolha da m√©trica mais adequada √© crucial, pois cada uma oferece diferentes perspectivas sobre a precis√£o da previs√£o, como discutido anteriormente [^10].

### Conceitos Fundamentais
A avalia√ß√£o da precis√£o da previs√£o √© essencial para determinar a confiabilidade de um modelo, utilizando m√©tricas que quantificam a magnitude e o tipo de erro de previs√£o. O erro de previs√£o √© definido como a diferen√ßa entre a demanda real e a previs√£o [^9]. Matematicamente, isso pode ser expresso como:

$$ \text{Erro de Previs√£o} = \text{Demanda Real} - \text{Previs√£o} $$ [^9]

Como as previs√µes s√£o para o futuro, o erro √© computado utilizando dados hist√≥ricos para avaliar a adequa√ß√£o da abordagem de previs√£o [^10].

#### Medidas de Erro de Previs√£o
V√°rias m√©tricas s√£o utilizadas para avaliar a precis√£o da previs√£o. Nesta se√ß√£o, iremos aprofundar nas tr√™s m√©tricas mais comuns: MAD, MSE e MAPE, al√©m de introduzir o RMSE e o MASE.

1.  **Desvio Absoluto M√©dio (MAD):** O MAD mede a magnitude m√©dia do erro de previs√£o em unidades absolutas. Ele representa a m√©dia das diferen√ßas absolutas entre os valores previstos e os valores reais [^10]. A f√≥rmula para o MAD √© dada por:
    $$ \text{MAD} = \frac{\sum |\text{Demanda Real} - \text{Previs√£o}|}{n} $$ [^10]
    onde *n* representa o n√∫mero de per√≠odos inclu√≠dos no c√°lculo [^10]. O MAD fornece uma vis√£o geral da magnitude do erro, sem levar em conta a dire√ß√£o do erro.
     > üí° **Exemplo Num√©rico:**
      > Consideremos uma s√©rie temporal e suas previs√µes:
      >
      > | Per√≠odo | Demanda Real ($y_t$) | Previs√£o ($\hat{y}_t$) |
      > |---|---|---|
      > | 1 | 100 | 110 |
      > | 2 | 120 | 115 |
      > | 3 | 130 | 125 |
      > | 4 | 150 | 140 |
      > | 5 | 160 | 155 |
      >
      > $\text{Step 1: Calcular os erros absolutos: }$
      >
      > $|100-110| = 10$
      > $|120-115| = 5$
      > $|130-125| = 5$
      > $|150-140| = 10$
      > $|160-155| = 5$
      >
      > $\text{Step 2: Calcular a m√©dia dos erros absolutos: }$
      >
      > $\text{MAD} = \frac{10 + 5 + 5 + 10 + 5}{5} = \frac{35}{5} = 7$
      >
      > Um MAD de 7 significa que, em m√©dia, as previs√µes est√£o a 7 unidades da demanda real.
      >
      > ```python
      > import numpy as np
      >
      > actual_demand = np.array([100, 120, 130, 150, 160])
      > forecast = np.array([110, 115, 125, 140, 155])
      >
      > absolute_errors = np.abs(actual_demand - forecast)
      > mad = np.mean(absolute_errors)
      > print(f"MAD: {mad}")
      > ```

2.  **Erro Quadr√°tico M√©dio (MSE):** O MSE mede a m√©dia dos quadrados dos erros de previs√£o. Ele penaliza erros maiores mais severamente do que erros menores [^12]. A f√≥rmula para MSE √©:

    $$ \text{MSE} = \frac{\sum (\text{Demanda Real} - \text{Previs√£o})^2}{n} $$ [^12]

    onde *n* √© o n√∫mero de per√≠odos considerados.
    
      > üí° **Exemplo Num√©rico:** Usando os mesmos dados do exemplo do MAD, o MSE √© calculado da seguinte forma:
      >
      > $\text{Step 1: Calcular os erros ao quadrado: }$
      >
      > $(100-110)^2 = (-10)^2 = 100$
      > $(120-115)^2 = (5)^2 = 25$
      > $(130-125)^2 = (5)^2 = 25$
      > $(150-140)^2 = (10)^2 = 100$
      > $(160-155)^2 = (5)^2 = 25$
      >
      > $\text{Step 2: Calcular a m√©dia dos erros ao quadrado: }$
      >
      > $\text{MSE} = \frac{100 + 25 + 25 + 100 + 25}{5} = \frac{275}{5} = 55$
      >
      > O MSE √© 55.
      > ```python
      > squared_errors = (actual_demand - forecast) ** 2
      > mse = np.mean(squared_errors)
      > print(f"MSE: {mse}")
      > ```

  **2.1 Raiz do Erro Quadr√°tico M√©dio (RMSE):** O RMSE √© a raiz quadrada do MSE, retornando o erro na mesma unidade dos dados originais, o que facilita a interpreta√ß√£o. √â dado por:

      $$ \text{RMSE} = \sqrt{\frac{\sum (\text{Demanda Real} - \text{Previs√£o})^2}{n}} = \sqrt{MSE} $$

     > üí° **Exemplo Num√©rico:** Usando o MSE calculado anteriormente, o RMSE √©:
     >
     > $\text{RMSE} = \sqrt{55} \approx 7.42$
     >
     > O RMSE √© de aproximadamente 7.42, o que est√° na mesma escala de unidade dos dados. O RMSE √© particularmente √∫til quando desejamos avaliar os erros de previs√£o na mesma unidade que os dados originais, e mant√©m a penaliza√ß√£o para grandes erros do MSE.
     >
     > ```python
     > rmse = np.sqrt(mse)
     > print(f"RMSE: {rmse}")
     > ```
    
    **Lema 2.1:** O RMSE √© sempre maior ou igual ao MAD para um mesmo conjunto de previs√µes.
    
    **Prova:** Pela desigualdade de Cauchy-Schwarz, para quaisquer n√∫meros reais $a_i$ e $b_i$, temos:
    
    $$ \left(\sum_{i=1}^n a_i b_i\right)^2 \leq \left(\sum_{i=1}^n a_i^2\right) \left(\sum_{i=1}^n b_i^2\right) $$
    
    I. Seja $a_i = |y_i - \hat{y}_i|$ e $b_i = 1$. Ent√£o:
    
    $$ \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2 \leq \left(\sum_{i=1}^n |y_i - \hat{y}_i|^2\right) \left(\sum_{i=1}^n 1^2\right) $$
    
    II. Simplificando, temos:
    
    $$ \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2 \leq n \sum_{i=1}^n (y_i - \hat{y}_i)^2 $$
    
   III. Dividindo ambos os lados por $n^2$ e tomando a raiz quadrada:
    
     $$ \sqrt{\frac{1}{n^2} \left(\sum_{i=1}^n |y_i - \hat{y}_i|\right)^2} \leq \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2} $$
    
    IV. Simplificando a express√£o, temos:
    
    $$ \frac{1}{n} \sum_{i=1}^n |y_i - \hat{y}_i| \leq \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2} $$
    
    V. Reconhecendo as f√≥rmulas de MAD e RMSE, chegamos a:
    
    $$ MAD \leq RMSE $$
    
    A igualdade ocorre apenas se todos os erros absolutos forem iguais. $\blacksquare$
   
3. **Erro Percentual Absoluto M√©dio (MAPE):** O MAPE expressa o erro como uma porcentagem da demanda real. Isso resolve o problema da depend√™ncia do volume encontrado no MAD e no MSE [^12]. O MAPE √© calculado como:
    $$ \text{MAPE} = \frac{\sum \left|\frac{\text{Demanda Real} - \text{Previs√£o}}{\text{Demanda Real}}\right|}{n} \times 100 $$ [^12]
     Um MAPE de 13,19%, por exemplo, indica que, em m√©dia, as previs√µes do modelo de suaviza√ß√£o exponencial com Œ±=0,4 desviam 13,19% da demanda real [^12].

      > üí° **Exemplo Num√©rico:** Usando os mesmos dados, o MAPE √© calculado como:
      >
      > $\text{Step 1: Calcular os erros percentuais absolutos: }$
      >
      > $|\frac{100-110}{100}| = |-\frac{10}{100}| = 0.10$
      > $|\frac{120-115}{120}| = |\frac{5}{120}| = 0.0417$
      > $|\frac{130-125}{130}| = |\frac{5}{130}| = 0.0385$
      > $|\frac{150-140}{150}| = |\frac{10}{150}| = 0.0667$
      > $|\frac{160-155}{160}| = |\frac{5}{160}| = 0.0313$
      >
      > $\text{Step 2: Calcular a m√©dia dos erros percentuais absolutos e multiplicar por 100: }$
      >
      > $\text{MAPE} = \frac{0.10 + 0.0417 + 0.0385 + 0.0667 + 0.0313}{5} \times 100 = \frac{0.2782}{5} \times 100 = 0.05564 \times 100 = 5.564\%$
      >
      > O MAPE √© de aproximadamente 5.564%, indicando que, em m√©dia, as previs√µes est√£o cerca de 5.564% da demanda real.
      >
      > ```python
      > absolute_percentage_errors = np.abs((actual_demand - forecast) / actual_demand)
      > mape = np.mean(absolute_percentage_errors) * 100
      > print(f"MAPE: {mape:.3f}%")
      > ```
    
    **Proposi√ß√£o 3.1:** O MAPE pode gerar valores indefinidos se a demanda real em algum per√≠odo for zero.
    
    **Prova:**
    
    I. A f√≥rmula do MAPE √©:
    $$ \text{MAPE} = \frac{\sum \left|\frac{\text{Demanda Real} - \text{Previs√£o}}{\text{Demanda Real}}\right|}{n} \times 100 $$
    
    II. A f√≥rmula envolve a divis√£o da diferen√ßa entre a demanda real e a previs√£o pela demanda real em cada per√≠odo: $\frac{\text{Demanda Real} - \text{Previs√£o}}{\text{Demanda Real}}$.
    
    III. Se em algum per√≠odo a demanda real for zero, a opera√ß√£o de divis√£o torna-se $\frac{\text{Demanda Real} - \text{Previs√£o}}{0}$, que √© indefinida.
    
    IV. Portanto, o MAPE n√£o √© definido para s√©ries temporais onde a demanda real em algum per√≠odo √© zero. $\blacksquare$
    
    **Observa√ß√£o 3.2:** Pequenas varia√ß√µes na demanda real, especialmente quando pr√≥ximos a zero, podem causar grandes flutua√ß√µes no MAPE, tornando-o inst√°vel nessas circunst√¢ncias.

4.  **Erro M√©dio Absoluto Escalonado (MASE):** O MASE √© √∫til para comparar modelos preditivos com um modelo *naive* (usualmente, o valor do per√≠odo anterior), e resolve as limita√ß√µes do MAPE quando a demanda √© pr√≥xima de zero. A f√≥rmula para o MASE √©:
    $$ \text{MASE} = \frac{\frac{1}{n} \sum_{t=1}^{n} |y_t - \hat{y}_t|}{\frac{1}{n-1}\sum_{t=2}^{n}|y_t - y_{t-1}|} $$
    onde $y_t$ √© a demanda real, $\hat{y}_t$ √© a previs√£o, e *n* √© o n√∫mero de per√≠odos. O denominador √© o MAD de um modelo *na√Øve*, enquanto o numerador √© o MAD do modelo avaliado.  Um MASE menor que 1 indica um modelo mais preciso que o *na√Øve*.
     > üí° **Exemplo Num√©rico:** Utilizando novamente os mesmos dados, e adicionando um valor anterior para calcular o denominador do MASE, temos:
     >
     > | Per√≠odo | Demanda Real ($y_t$) | Previs√£o ($\hat{y}_t$) |
     > |---|---|---|
     > | 0 | 90| - |
     > | 1 | 100 | 110 |
     > | 2 | 120 | 115 |
     > | 3 | 130 | 125 |
     > | 4 | 150 | 140 |
     > | 5 | 160 | 155 |
     >
     >
     > $\text{Step 1: Calcular o numerador (MAD do modelo): }$
     >
     > J√° calculamos o MAD no primeiro exemplo, que √© 7. Logo, o numerador √© igual a 7.
     >
     > $\text{Step 2: Calcular o denominador (MAD do modelo naive): }$
     >
     > $|100-90| = 10$
     > $|120-100| = 20$
     > $|130-120| = 10$
     > $|150-130| = 20$
     > $|160-150| = 10$
     >
     > $\text{Denominador} = \frac{10 + 20 + 10 + 20 + 10}{5-1} = \frac{70}{4} = 17.5$
     >
     > $\text{Step 3: Calcular o MASE: }$
     >
     > $\text{MASE} = \frac{7}{17.5} \approx 0.4$
     >
     > Como o MASE √© menor que 1, nosso modelo √© mais preciso do que o modelo *naive*.
     >
     > ```python
     > actual_demand_with_prev = np.array([90, 100, 120, 130, 150, 160])
     > naive_forecast_errors = np.abs(actual_demand_with_prev[1:] - actual_demand_with_prev[:-1])
     > mase_denominator = np.mean(naive_forecast_errors)
     > mase = mad / mase_denominator
     > print(f"MASE: {mase:.3f}")
     > ```
    
#### Escolha do Modelo Adequado
A escolha do modelo apropriado e das m√©tricas de avalia√ß√£o de precis√£o depende do objetivo da an√°lise. Modelos com maior capacidade de resposta, como WMA e suaviza√ß√£o exponencial com Œ± alto, tendem a oferecer maior precis√£o para alguns dados hist√≥ricos [^12].

**Lema 1:** A sele√ß√£o da m√©trica de erro apropriada depende do objetivo principal da an√°lise. O MAD, por exemplo, √© apropriado quando o foco √© entender a magnitude m√©dia dos erros de previs√£o em termos absolutos da vari√°vel. Se a penaliza√ß√£o de grandes erros for importante, o MSE ou RMSE s√£o mais adequados. O MAPE √© adequado quando o objetivo √© expressar o erro como uma porcentagem, contanto que a demanda n√£o seja pr√≥xima de zero. Nesses casos, o MASE pode ser uma melhor escolha.
> üí° **Exemplo Comparativo:**
> Para ilustrar a import√¢ncia da escolha da m√©trica de avalia√ß√£o de erros, vejamos um exemplo com dois modelos preditivos para a mesma s√©rie temporal:
>
> | Modelo | MAD | MSE | RMSE | MAPE (%) | MASE |
> |---|---|---|---|---|---|
> | Modelo 1 | 7 | 55 | 7.42 | 5.56 | 0.4 |
> | Modelo 2 | 10 | 120 | 10.95 | 7.00 | 0.6 |
>
> O Modelo 1 tem um MAD, MSE, RMSE e MAPE menores do que o Modelo 2. Isso indica que o Modelo 1 apresenta menor magnitude de erros e penaliza menos os grandes erros, com um menor erro em termos percentuais e um melhor desempenho do que um modelo *naive*. Para este exemplo, todas as m√©tricas est√£o de acordo na avalia√ß√£o de que o Modelo 1 √© mais preciso para esta s√©rie temporal. A escolha da m√©trica deve se alinhar aos objetivos espec√≠ficos da an√°lise: priorizar MAD se o foco for o erro m√©dio, MSE e RMSE para grandes erros, MAPE para valores relativos, e MASE se a demanda for pr√≥xima a zero.
>
> ```python
> import pandas as pd
> data = {'Modelo': ['Modelo 1', 'Modelo 2'],
>         'MAD': [7, 10],
>         'MSE': [55, 120],
>         'RMSE': [7.42, 10.95],
>         'MAPE (%)': [5.56, 7.00],
>         'MASE': [0.4, 0.6]}
> df = pd.DataFrame(data)
> print(df)
> ```

### Conclus√£o
A avalia√ß√£o da precis√£o da previs√£o √© um aspecto fundamental na modelagem de s√©ries temporais. Este cap√≠tulo explorou as tr√™s m√©tricas mais comuns para quantificar os erros de previs√£o, MAD, MSE, MAPE, al√©m de introduzir o RMSE e o MASE.  Cada m√©trica oferece uma perspectiva √∫nica sobre a precis√£o da previs√£o, destacando a import√¢ncia de escolher a m√©trica mais adequada de acordo com as necessidades do problema em quest√£o.  A escolha do modelo e da m√©trica de avalia√ß√£o devem ser baseadas na necessidade do neg√≥cio, tendo em mente que diferentes m√©tricas podem convergir para um mesmo resultado, como vimos no exemplo comparativo. No final, a capacidade de avaliar a precis√£o da previs√£o √© fundamental para escolher o melhor modelo e, consequentemente, melhorar o planejamento e a aloca√ß√£o de recursos [^23].

### Refer√™ncias
[^5]: *Time series models assume that past demand data are representative of future demand.*
[^9]: *Forecast error = Actual demand - Forecast.*
[^10]: *Because a forecast predicts future demand, we cannot compare it to actual demand. However, because we have assumed that historical demand is representative of future demand, we can formulate "forecasts of the past" using a particular model and compare those forecasts to historical demand.*
[^12]: *With both the MAD and MSE, the size of the deviations depends on the volume of the item being forecast. For example, if the demand is in thousands of units, the absolute and squared deviations could be quite large. The mean absolute percentage error (MAPE) remedies this problem by expressing the deviation as a percentage of the actual demand.*
[^15]: *Exponential smoothing (ES) is one of the most popular forecasting techniques. It is similar to a WMA technique in the sense that it assigns (a) a weight between 0 and 1 (called the "smoothing constant"), a, to the actual demand in the previous period and (b) a weight (1 ‚Äì a) to the exponential smoothing forecast for the previous period*
[^19]: *In a time series, seasonality is expressed as the amount of deviation between the actual demand values and the average value of the series.*
[^23]: *Forecasting demand is important to be able to plan and allocate the resources necessary to provide uninterrupted, quality customer service and avoid the excess costs arising from mismatched demand and supply.*
<!-- END -->
