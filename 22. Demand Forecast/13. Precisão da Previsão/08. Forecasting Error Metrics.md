## Avalia√ß√£o da Precis√£o da Previs√£o em S√©ries Temporais e M√©tricas de Erro

### Introdu√ß√£o
Este cap√≠tulo visa consolidar e aprofundar nosso entendimento sobre a avalia√ß√£o da precis√£o de previs√µes em s√©ries temporais, com foco espec√≠fico no uso de m√©tricas de erro como o Desvio Absoluto M√©dio (MAD), o Erro Quadr√°tico M√©dio (MSE), a Raiz do Erro Quadr√°tico M√©dio (RMSE), o Erro Percentual Absoluto M√©dio (MAPE) e o Erro M√©dio Absoluto Escalonado (MASE). Abordamos tamb√©m a rela√ß√£o entre as m√©tricas de erro, padr√µes na s√©rie temporal e sele√ß√£o do modelo mais apropriado. Nos cap√≠tulos anteriores, introduzimos esses conceitos e exploramos sua aplica√ß√£o, mas aqui, o objetivo √© fornecer uma an√°lise abrangente e rigorosa, utilizando exemplos num√©ricos para ilustrar como essas m√©tricas s√£o calculadas e interpretadas.

### Conceitos Fundamentais
A modelagem de s√©ries temporais √© uma ferramenta crucial para previs√£o, e a avalia√ß√£o da qualidade das previs√µes √© um componente essencial deste processo [^5]. O erro de previs√£o, a diferen√ßa entre a demanda real e a previs√£o, √© a base das m√©tricas que utilizaremos neste cap√≠tulo [^9]:
$$ \text{Erro de Previs√£o} = \text{Demanda Real} - \text{Previs√£o} $$ [^9]

O objetivo central √© utilizar os dados hist√≥ricos para quantificar o erro de previs√£o e escolher o modelo mais preciso [^10]. A escolha da m√©trica de erro √© t√£o importante quanto a minimiza√ß√£o do erro, e deve levar em considera√ß√£o os objetivos da an√°lise.

#### M√©tricas de Erro de Previs√£o

Nesta se√ß√£o, vamos consolidar o nosso conhecimento sobre as m√©tricas de erro de previs√£o abordadas nos cap√≠tulos anteriores, e que s√£o essenciais para avaliar modelos de s√©ries temporais.

1.  **Desvio Absoluto M√©dio (MAD):** O MAD mede a magnitude m√©dia dos erros em unidades absolutas, oferecendo uma vis√£o direta da precis√£o m√©dia das previs√µes [^10].
    $$ \text{MAD} = \frac{\sum |\text{Demanda Real} - \text{Previs√£o}|}{n} $$ [^10]
    
    > üí° **Exemplo Num√©rico:**
    > Considere uma s√©rie temporal de vendas de um produto e as previs√µes geradas por um modelo:
    >
    > | Per√≠odo (t) | Demanda Real ($y_t$) | Previs√£o ($\hat{y}_t$) |
    > |---|---|---|
    > | 1 | 150 | 160 |
    > | 2 | 170 | 165 |
    > | 3 | 180 | 175 |
    > | 4 | 200 | 190 |
    > | 5 | 210 | 205 |
    > | 6 | 220 | 230 |
    > | 7 | 200 | 195 |
    > | 8 | 205 | 215 |
    >
    > $\text{Step 1: Calcular os erros absolutos: }$
    >
    > $|150 - 160| = 10$
    > $|170 - 165| = 5$
    > $|180 - 175| = 5$
    > $|200 - 190| = 10$
    > $|210 - 205| = 5$
     > $|220 - 230| = 10$
     > $|200 - 195| = 5$
     > $|205 - 215| = 10$
    >
    > $\text{Step 2: Calcular a m√©dia dos erros absolutos: }$
    >
    > $\text{MAD} = \frac{10 + 5 + 5 + 10 + 5 + 10 + 5 + 10}{8} = \frac{60}{8} = 7.5$
    >
    > O MAD √© 7.5, o que indica que, em m√©dia, as previs√µes t√™m um desvio de 7.5 unidades da demanda real.
  
    **Lema 1.1** O MAD √© robusto a outliers, no sentido que erros muito grandes n√£o dominam o valor final da m√©trica.
    
    *Proof:*
    I. O MAD √© calculado pela m√©dia dos valores absolutos dos erros:
    $$ \text{MAD} = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i| $$.
    
    II. Cada erro individual $|y_i - \hat{y}_i|$ contribui linearmente para o MAD. Isso significa que se um erro √© dobrado, sua contribui√ß√£o para o MAD tamb√©m dobra.

    III. Comparado ao MSE, onde os erros s√£o elevados ao quadrado, no MAD o impacto de um erro grande √© muito menor. Um erro duas vezes maior causa um impacto duas vezes maior no MAD e quatro vezes maior no MSE.

    IV. Portanto, outliers (erros muito grandes) t√™m um impacto proporcionalmente menor no MAD, tornando-o mais robusto √† presen√ßa de outliers.
    ‚ñ†

2.  **Erro Quadr√°tico M√©dio (MSE):** O MSE calcula a m√©dia dos erros ao quadrado, penalizando erros maiores de forma mais significativa [^12].
    $$ \text{MSE} = \frac{\sum (\text{Demanda Real} - \text{Previs√£o})^2}{n} $$ [^12]

    > üí° **Exemplo Num√©rico:** Usando os mesmos dados do exemplo anterior, calculamos o MSE:
    >
    > $\text{Step 1: Calcular os erros ao quadrado: }$
    >
    > $(150-160)^2 = 100$
    > $(170-165)^2 = 25$
    > $(180-175)^2 = 25$
    > $(200-190)^2 = 100$
    > $(210-205)^2 = 25$
    > $(220-230)^2 = 100$
    > $(200-195)^2 = 25$
    > $(205-215)^2 = 100$
    >
    > $\text{Step 2: Calcular a m√©dia dos erros ao quadrado: }$
    >
    > $\text{MSE} = \frac{100 + 25 + 25 + 100 + 25 + 100 + 25 + 100}{8} = \frac{500}{8} = 62.5$
    >
    > O MSE √© 62.5, indicando a m√©dia dos quadrados dos erros de previs√£o. Observe que o valor do MSE √© sempre maior que o valor do MAD.

3. **Raiz do Erro Quadr√°tico M√©dio (RMSE):** O RMSE √© a raiz quadrada do MSE, expressando o erro na mesma unidade dos dados originais e mantendo a penaliza√ß√£o para grandes erros [^1].
   
       $$ \text{RMSE} = \sqrt{\frac{\sum (\text{Demanda Real} - \text{Previs√£o})^2}{n}} = \sqrt{MSE} $$

      > üí° **Exemplo Num√©rico:** Usando o MSE calculado anteriormente, o RMSE √©:
      >
      > $\text{RMSE} = \sqrt{62.5} \approx 7.91$
      >
      > O RMSE √© de aproximadamente 7.91, o que est√° na mesma escala de unidade dos dados.
  
    **Lema 3.1** O RMSE √© sens√≠vel a outliers devido ao uso do quadrado dos erros.

    *Proof:* 
    I. O RMSE √© calculado como a raiz quadrada do MSE:
    $$ \text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2} $$.

    II. O MSE eleva ao quadrado os erros $(y_i - \hat{y}_i)$. Isto significa que, um erro maior ter√° um impacto maior no MSE e, consequentemente, no RMSE.

    III. Se um erro for dobrado, seu quadrado ser√° quadruplicado, resultando em um impacto maior no MSE e, por fim, no RMSE.
    
    IV. Portanto, outliers (erros muito grandes) t√™m um impacto desproporcionalmente maior no RMSE, tornando-o sens√≠vel a outliers.
    ‚ñ†
    
    **Proposi√ß√£o 3.1** O RMSE sempre ser√° maior ou igual ao MAD.

    *Proof:* 
   I. Vamos come√ßar com a desigualdade de Cauchy-Schwarz para dois vetores $u$ e $v$:
    $$ (\sum_{i=1}^{n} |u_i v_i|)^2 \leq (\sum_{i=1}^{n} u_i^2)(\sum_{i=1}^{n} v_i^2) $$.

   II. Se tomarmos $u_i = 1$ e $v_i = |y_i - \hat{y}_i|$  (o erro absoluto da previs√£o), temos:
   $$ (\sum_{i=1}^{n} |y_i - \hat{y}_i|)^2 \leq (\sum_{i=1}^{n} 1^2) (\sum_{i=1}^{n} (y_i - \hat{y}_i)^2) $$

   III. Simplificando, obtemos:
   $$ (\sum_{i=1}^{n} |y_i - \hat{y}_i|)^2 \leq n \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 $$

   IV. Dividindo ambos os lados por $n^2$:
    $$ \frac{1}{n^2} (\sum_{i=1}^{n} |y_i - \hat{y}_i|)^2 \leq \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 $$

   V. Tomando a raiz quadrada de ambos os lados:
   $$ \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i| \leq \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2} $$

   VI. O lado esquerdo da desigualdade √© o MAD, e o lado direito √© o RMSE:
     $$ \text{MAD} \leq \text{RMSE} $$
   ‚ñ†

4.  **Erro Percentual Absoluto M√©dio (MAPE):** O MAPE expressa o erro como uma porcentagem da demanda real, facilitando a compara√ß√£o entre diferentes s√©ries temporais, desde que n√£o apresentem valores pr√≥ximos a zero [^12].
    $$ \text{MAPE} = \frac{\sum \left|\frac{\text{Demanda Real} - \text{Previs√£o}}{\text{Demanda Real}}\right|}{n} \times 100 $$ [^12]

     > üí° **Exemplo Num√©rico:** Usando os mesmos dados, o MAPE √© calculado como:
      >
      > $\text{Step 1: Calcular os erros percentuais absolutos: }$
      >
      > $|\frac{150-160}{150}| = |-\frac{10}{150}| = 0.0667$
      > $|\frac{170-165}{170}| = |\frac{5}{170}| = 0.0294$
      > $|\frac{180-175}{180}| = |\frac{5}{180}| = 0.0278$
      > $|\frac{200-190}{200}| = |\frac{10}{200}| = 0.0500$
      > $|\frac{210-205}{210}| = |\frac{5}{210}| = 0.0238$
      > $|\frac{220-230}{220}| = |-\frac{10}{220}| = 0.0455$
      > $|\frac{200-195}{200}| = |\frac{5}{200}| = 0.0250$
      > $|\frac{205-215}{205}| = |-\frac{10}{205}| = 0.0488$
      >
      > $\text{Step 2: Calcular a m√©dia dos erros percentuais absolutos e multiplicar por 100: }$
      >
      > $\text{MAPE} = \frac{0.0667 + 0.0294 + 0.0278 + 0.0500 + 0.0238 + 0.0455 + 0.0250 + 0.0488}{8} \times 100 = \frac{0.3168}{8} \times 100 = 0.0396 \times 100 = 3.96\%$
      >
      > O MAPE √© de aproximadamente 3.96%, indicando que, em m√©dia, as previs√µes est√£o cerca de 3.96% da demanda real.
    
    **Lema 4.1** O MAPE √© indefinido se a demanda real for zero.
    
    *Proof:*
    I. A f√≥rmula do MAPE √© dada por:
    $$ \text{MAPE} = \frac{1}{n} \sum_{t=1}^n \left| \frac{y_t - \hat{y}_t}{y_t} \right| \times 100 $$

    II. A express√£o $\frac{y_t - \hat{y}_t}{y_t}$ est√° definida se e somente se $y_t \neq 0$ para todos os per√≠odos.

    III. Se em algum per√≠odo $t$, a demanda real $y_t$ for igual a zero, a divis√£o por zero torna o termo indefinido.

    IV. Portanto, se a demanda real for zero para algum per√≠odo, o MAPE n√£o pode ser calculado e, ent√£o, √© indefinido.
    ‚ñ†
    
    **Observa√ß√£o 4.1** O MAPE pode apresentar valores muito grandes se a demanda real for pr√≥xima de zero, mesmo que os erros absolutos sejam pequenos.
    
    *Justification:*  Quando a demanda real √© um n√∫mero pequeno, a divis√£o do erro por esse n√∫mero, mesmo que o erro seja pequeno, resulta em um percentual alto. Assim, a m√©dia desses percentuais ser√°, tamb√©m, um valor muito grande. Essa caracter√≠stica pode mascarar a qualidade real de um modelo.

5.  **Erro M√©dio Absoluto Escalonado (MASE):** O MASE √© usado para comparar modelos preditivos com um modelo *naive*, e contorna as limita√ß√µes do MAPE quando a demanda √© pr√≥xima de zero [^1]:
    $$ \text{MASE} = \frac{\frac{1}{n} \sum_{t=1}^{n} |y_t - \hat{y}_t|}{\frac{1}{n-1}\sum_{t=2}^{n}|y_t - y_{t-1}|} $$
        
    > üí° **Exemplo Num√©rico:** Utilizando novamente os mesmos dados e adicionando um valor anterior para calcular o denominador, temos:
      >
      > | Per√≠odo | Demanda Real ($y_t$) | Previs√£o ($\hat{y}_t$) |
      > |---|---|---|
      > | 0 | 140| - |
      > | 1 | 150 | 160 |
      > | 2 | 170 | 165 |
      > | 3 | 180 | 175 |
      > | 4 | 200 | 190 |
      > | 5 | 210 | 205 |
       >| 6 | 220 | 230 |
       >| 7 | 200 | 195 |
       >| 8 | 205 | 215 |
      >
      >
      > $\text{Step 1: Calcular o numerador (MAD do modelo): }$
      >
      > O MAD j√° foi calculado anteriormente, sendo igual a 7.5.
      >
      > $\text{Step 2: Calcular o denominador (MAD do modelo naive): }$
      >
      > $|150-140| = 10$
      > $|170-150| = 20$
      > $|180-170| = 10$
      > $|200-180| = 20$
      > $|210-200| = 10$
      > $|220-210| = 10$
      > $|200-220| = 20$
      > $|205-200| = 5$
      >
      > $\text{Denominador} = \frac{10 + 20 + 10 + 20 + 10 + 10 + 20 + 5}{8-1} = \frac{105}{7} = 15$
      >
      > $\text{Step 3: Calcular o MASE: }$
      >
      > $\text{MASE} = \frac{7.5}{15} = 0.5$
      >
      > O MASE √© 0.5, o que indica que o modelo de previs√£o √© melhor que o modelo naive.

    
    **Teorema 5.1** Se MASE < 1, o modelo de previs√£o √© melhor que o modelo *naive*. Se MASE > 1, o modelo de previs√£o √© pior que o modelo *naive*. Se MASE = 1, o modelo de previs√£o tem o mesmo desempenho que o modelo *naive*.
    
    *Proof:*
    I. O MASE √© definido como:
    $$ \text{MASE} = \frac{\frac{1}{n} \sum_{t=1}^{n} |y_t - \hat{y}_t|}{\frac{1}{n-1}\sum_{t=2}^{n}|y_t - y_{t-1}|} $$

    II. O numerador √© o MAD do modelo de previs√£o: 
    $$ \text{MAD}_{\text{modelo}} = \frac{1}{n} \sum_{t=1}^{n} |y_t - \hat{y}_t| $$
    
    III. O denominador √© o MAD do modelo *naive* (onde a previs√£o √© o valor do per√≠odo anterior):
    $$ \text{MAD}_{\text{naive}} = \frac{1}{n-1}\sum_{t=2}^{n}|y_t - y_{t-1}| $$

    IV. Assim, o MASE √© a raz√£o entre o MAD do modelo e o MAD do modelo *naive*:
    $$ \text{MASE} = \frac{\text{MAD}_{\text{modelo}}}{\text{MAD}_{\text{naive}}} $$
    
    V. Se $\text{MASE} < 1$, ent√£o $\text{MAD}_{\text{modelo}} < \text{MAD}_{\text{naive}}$, o que significa que o modelo de previs√£o tem um erro absoluto m√©dio menor que o modelo *naive* e, portanto, √© melhor.
    
    VI. Se $\text{MASE} > 1$, ent√£o $\text{MAD}_{\text{modelo}} > \text{MAD}_{\text{naive}}$, o que significa que o modelo de previs√£o tem um erro absoluto m√©dio maior que o modelo *naive* e, portanto, √© pior.
    
    VII. Se $\text{MASE} = 1$, ent√£o $\text{MAD}_{\text{modelo}} = \text{MAD}_{\text{naive}}$, o que significa que o modelo de previs√£o tem o mesmo desempenho que o modelo *naive*.
    ‚ñ†

#### Escolha da M√©trica de Erro Adequada
A escolha da m√©trica depende do objetivo da an√°lise e das caracter√≠sticas da s√©rie temporal [^1, ^10, ^12].

*   O **MAD** √© adequado quando se deseja uma vis√£o direta da magnitude dos erros em unidades absolutas [^10].
*   O **MSE** penaliza mais os grandes erros, sendo √∫til quando esses erros s√£o mais cr√≠ticos e devem ser evitados, mas n√£o √© expressa na unidade dos dados originais [^12].
*   O **RMSE** expressa o erro na mesma unidade dos dados originais, e mant√©m a penaliza√ß√£o para grandes erros do MSE.
*   O **MAPE** √© √∫til para comparar modelos e s√©ries temporais de diferentes magnitudes, mas pode ser inst√°vel quando h√° valores de demanda pr√≥ximos a zero [^12].
*   O **MASE** √© apropriado para comparar modelos preditivos com um modelo *naive*, e resolve as limita√ß√µes do MAPE quando a demanda √© pr√≥xima de zero.

A sele√ß√£o da m√©trica deve ser feita de acordo com a necessidade do problema.

#### Avalia√ß√£o de Modelos e Presen√ßa de Padr√µes
Como abordado em cap√≠tulos anteriores, modelos de previs√£o podem ter par√¢metros como o fator de suaviza√ß√£o $\alpha$ da suaviza√ß√£o exponencial ou os pesos da m√©dia m√≥vel ponderada [^9].
Se valores altos de $\alpha$ (na suaviza√ß√£o exponencial) ou pesos maiores nos dados mais recentes (na m√©dia m√≥vel ponderada) levam a previs√µes mais precisas, isso sugere que os dados recentes s√£o mais informativos sobre o futuro, e que, portanto, padr√µes como tend√™ncia e sazonalidade podem estar presentes.  Nessas situa√ß√µes, modelos que levam em considera√ß√£o explicitamente esses padr√µes devem ser utilizados [^15, ^19].

1.  **Suaviza√ß√£o Exponencial com Ajuste de Tend√™ncia (TAES):** O TAES ajusta a tend√™ncia da s√©rie temporal, sendo √∫til quando a s√©rie apresenta um padr√£o crescente ou decrescente [^15].

2.  **Decomposi√ß√£o Sazonal:** Modelos como a regress√£o linear com ajuste sazonal s√£o usados para decompor uma s√©rie temporal em suas componentes, incluindo a tend√™ncia e a sazonalidade, e isso permite criar modelos mais precisos [^19].

3.  **Modelos ARIMA:** Os modelos Auto-Regressivos Integrados de M√©dias M√≥veis (ARIMA) s√£o usados para capturar a autocorrela√ß√£o nos dados e modelar padr√µes complexos, incluindo tend√™ncia e sazonalidade [^1].

> üí° **Exemplo Num√©rico:**
> Vamos analisar os resultados de diferentes modelos de previs√£o, calculando as m√©tricas de erro para cada um deles, para escolher o modelo mais apropriado:
>
> | Modelo | MAD | MSE | RMSE | MAPE (%) | MASE |
> |---|---|---|---|---|---|
> | Modelo 1 (SMA) | 12.5 | 200 | 14.1 | 15% | 0.9 |
> | Modelo 2 (WMA) | 9.0  | 120 | 11 | 10%  | 0.7 |
> | Modelo 3 (TAES) | 7.0 | 70 | 8.3 | 6% | 0.5 |
> | Modelo 4 (ARIMA) | 6.0 | 50 | 7.1 | 5% | 0.4 |
>
> Neste caso, o modelo 4 (ARIMA) apresenta os menores valores para todas as m√©tricas, indicando um desempenho superior em compara√ß√£o com os outros modelos. O modelo 3 (TAES) apresenta o segundo melhor desempenho, e o modelo 2 (WMA) o terceiro melhor, indicando que padr√µes como tend√™ncia s√£o relevantes nesses dados, enquanto o modelo 1 (SMA) √© o menos preciso.

### Conclus√£o
Neste cap√≠tulo, consolidamos o conhecimento sobre avalia√ß√£o de precis√£o de previs√µes em s√©ries temporais. O foco foi o uso de m√©tricas de erro como o MAD, MSE, RMSE, MAPE e MASE. Demonstramos como as m√©tricas de erro e par√¢metros dos modelos podem indicar padr√µes, o que por sua vez, auxilia na escolha do modelo de previs√£o ideal, levando em conta as caracter√≠sticas dos dados e os objetivos da an√°lise. A utiliza√ß√£o conjunta das m√©tricas e das ferramentas de an√°lise de padr√µes permite a escolha de modelos que geram previs√µes mais precisas e confi√°veis [^1, ^5, ^9, ^10, ^12, ^15, ^19, ^23].
Compreender esses conceitos e suas inter-rela√ß√µes √© fundamental para a modelagem eficaz de s√©ries temporais e a tomada de decis√µes baseada em dados.

### Refer√™ncias
[^1]: As refer√™ncias est√£o contidas nos t√≥picos anteriores.
[^5]: *Time series models assume that past demand data are representative of future demand.*
[^9]: *Forecast error = Actual demand - Forecast.*
[^10]: *Because a forecast predicts future demand, we cannot compare it to actual demand. However, because we have assumed that historical demand is representative of future demand, we can formulate "forecasts of the past" using a particular model and compare those forecasts to historical demand.*
[^12]: *With both the MAD and MSE, the size of the deviations depends on the volume of the item being forecast. For example, if the demand is in thousands of units, the absolute and squared deviations could be quite large. The mean absolute percentage error (MAPE) remedies this problem by expressing the deviation as a percentage of the actual demand.*
[^15]: *Exponential smoothing (ES) is one of the most popular forecasting techniques. It is similar to a WMA technique in the sense that it assigns (a) a weight between 0 and 1 (called the "smoothing constant"), a, to the actual demand in the previous period and (b) a weight (1 ‚Äì a) to the exponential smoothing forecast for the previous period*
[^19]: *In a time series, seasonality is expressed as the amount of deviation between the actual demand values and the average value of the series.*
[^23]: *Forecasting demand is important to be able to plan and allocate the resources necessary to provide uninterrupted, quality customer service and avoid the excess costs arising from mismatched demand and supply.*
<!-- END -->
