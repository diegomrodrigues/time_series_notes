## Decomposi√ß√£o de S√©ries Temporais: An√°lise Avan√ßada de Componentes

### Introdu√ß√£o
Dando seguimento √† nossa explora√ß√£o sobre previs√£o de demanda e modelagem de sazonalidade [^1], este cap√≠tulo aprofunda-se nas t√©cnicas de **decomposi√ß√£o de s√©ries temporais**, com um foco particular em como identificar e isolar os componentes de tend√™ncia, sazonalidade, ciclo e ru√≠do (ou varia√ß√£o irregular) [^4]. A decomposi√ß√£o de s√©ries temporais √© fundamental para an√°lises mais aprofundadas, permitindo modelar cada componente separadamente e aprimorar a precis√£o das previs√µes. Al√©m disso, introduziremos m√©todos avan√ßados, como an√°lise funcional e an√°lise espectral, para decompor s√©ries temporais de maneira mais sofisticada, complementando os m√©todos tradicionais j√° explorados [^18, 19].

### Conceitos Fundamentais
A decomposi√ß√£o de s√©ries temporais √© o processo de quebrar uma s√©rie temporal em seus componentes subjacentes, que geralmente incluem tend√™ncia, sazonalidade, ciclo e um componente residual, tamb√©m chamado de ru√≠do ou varia√ß√£o irregular [^4]. Essa decomposi√ß√£o permite entender melhor os fatores que influenciam a demanda e model√°-los de forma independente. Em geral, esta t√©cnica √© √∫til para:
1. **Isolar a Tend√™ncia:** A tend√™ncia √© o movimento de longo prazo em uma s√©rie temporal. Compreend√™-la ajuda a prever a dire√ß√£o geral da demanda no futuro [^4].
2. **Identificar a Sazonalidade:** A sazonalidade s√£o os padr√µes regulares e repetitivos dentro de um per√≠odo fixo (e.g. anual). Identificar e modelar a sazonalidade √© crucial para previs√µes precisas, como vimos no cap√≠tulo anterior [^1, 18, 19].
3. **Analisar Ciclos:** Os ciclos s√£o padr√µes de crescimento e decl√≠nio que se repetem ao longo de um per√≠odo de tempo maior que um ano, frequentemente relacionados a fatores econ√¥micos.
4.  **Remover Ru√≠do:** O ru√≠do s√£o varia√ß√µes aleat√≥rias ou irregulares na demanda que n√£o seguem padr√µes definidos. Remover o ru√≠do melhora a qualidade das an√°lises dos componentes mais regulares.

A decomposi√ß√£o de uma s√©rie temporal $Y_t$ pode ser expressa como a soma (modelo aditivo) ou o produto (modelo multiplicativo) desses componentes:

**Defini√ß√£o 1.** (Modelo Aditivo) No modelo aditivo, a s√©rie temporal $Y_t$ √© decomposta da seguinte forma:
$$Y_t = T_t + S_t + C_t + R_t$$
onde:
    - $T_t$ √© a componente de tend√™ncia no tempo $t$;
    - $S_t$ √© a componente de sazonalidade no tempo $t$;
    - $C_t$ √© a componente de ciclo no tempo $t$;
    - $R_t$ √© o componente residual ou ru√≠do no tempo $t$.

**Defini√ß√£o 2.** (Modelo Multiplicativo) No modelo multiplicativo, a s√©rie temporal $Y_t$ √© decomposta da seguinte forma:
$$Y_t = T_t \times S_t \times C_t \times R_t$$
onde:
    - $T_t$ √© a componente de tend√™ncia no tempo $t$;
    - $S_t$ √© a componente de sazonalidade no tempo $t$;
    - $C_t$ √© a componente de ciclo no tempo $t$;
    - $R_t$ √© o componente residual ou ru√≠do no tempo $t$.

Em muitos casos, o componente de ciclo ($C_t$) pode ser mais dif√≠cil de isolar e, portanto, pode ser combinado com o ru√≠do ($R_t$) para simplificar a an√°lise.

**Observa√ß√£o 1.** A escolha entre o modelo aditivo e multiplicativo geralmente depende da natureza dos dados. Se a amplitude das varia√ß√µes sazonais aumentar com a tend√™ncia, o modelo multiplicativo √© mais adequado. Caso contr√°rio, o modelo aditivo pode ser prefer√≠vel. Outros modelos podem ser considerados, como modelos mistos ou logar√≠tmicos, dependendo da necessidade.

#### Decomposi√ß√£o Cl√°ssica
A decomposi√ß√£o cl√°ssica √© um m√©todo tradicional para separar os componentes de uma s√©rie temporal [^19]. Ele envolve os seguintes passos:
1. **Estimativa da Tend√™ncia:** A tend√™ncia √© geralmente estimada atrav√©s de t√©cnicas de suaviza√ß√£o, como a m√©dia m√≥vel, ou por regress√£o linear [^1, 4].
2. **Remo√ß√£o da Tend√™ncia:** A tend√™ncia √© removida da s√©rie temporal original para isolar os componentes de sazonalidade, ciclo e ru√≠do.
   - *Modelo Aditivo:*  $Y_t - T_t$
   - *Modelo Multiplicativo:* $Y_t / T_t$
3. **Estimativa da Sazonalidade:** A componente sazonal √© estimada a partir da s√©rie temporal desentendidada. Isso √© feito calculando a m√©dia dos valores para cada per√≠odo sazonal (por exemplo, cada m√™s ou trimestre) ao longo de v√°rios ciclos sazonais. Se utilizarmos os √≠ndices sazonais calculados no cap√≠tulo anterior, este passo j√° est√° completo [^1, 18, 19].
4. **Remo√ß√£o da Sazonalidade:** A componente sazonal √© removida da s√©rie temporal desentendidada, isolando o componente de ciclo e ru√≠do.
   - *Modelo Aditivo:* $(Y_t - T_t) - S_t$
   - *Modelo Multiplicativo:* $(Y_t / T_t) / S_t$
5. **An√°lise do Ru√≠do e Ciclo:** O que resta ap√≥s remover a tend√™ncia e a sazonalidade representa o ru√≠do e, possivelmente, um ciclo. Este componente pode ser analisado para buscar padr√µes residuais ou identificar eventos excepcionais que afetam a demanda.

##### Exemplo Num√©rico de Decomposi√ß√£o Cl√°ssica (Multiplicativa)
Utilizando os mesmos dados de vendas trimestrais do produto do cap√≠tulo anterior:
| Trimestre | Ano 1 | Ano 2 | Ano 3 |
|-----------|-------|-------|-------|
| Q1        | 120   | 130   | 145   |
| Q2        | 150   | 160   | 175   |
| Q3        | 90    | 100   | 110   |
| Q4        | 140   | 150   | 165   |

E os √≠ndices sazonais calculados:
- √çndice Sazonal Q1: 0.97
- √çndice Sazonal Q2: 1.19
- √çndice Sazonal Q3: 0.73
- √çndice Sazonal Q4: 1.11

1. **Estimativa da Tend√™ncia:** Vamos obter uma estimativa linear da tend√™ncia usando regress√£o linear:
        
         $$\hat{Y} = a + bx$$. Onde *x* representa o trimestre (1 a 12) e $\hat{Y}$ representa a demanda. Usando um software estat√≠stico, obtemos: $\hat{Y} = 110 + 3.5x$.

2. **Remo√ß√£o da Tend√™ncia:** Calculamos $Y_t / T_t$ para cada trimestre:
     -  Trimestre 1, Ano 1: $120 / (110 + 3.5(1)) = 1.05$
     -  Trimestre 2, Ano 1: $150 / (110 + 3.5(2)) = 1.26$
    E assim por diante at√© o trimestre 12 do ano 3.

3. **Estimativa da Sazonalidade:** J√° calculamos no cap√≠tulo anterior os √≠ndices sazonais.
4. **Remo√ß√£o da Sazonalidade:** Dividimos o valor ap√≥s a remo√ß√£o da tend√™ncia pelo √≠ndice sazonal. Exemplo do trimestre 1, Ano 1: $1.05/0.97 \approx 1.08$. Repetimos este c√°lculo para todos os outros trimestres. O que resta representa a componente de ciclo e ru√≠do.

> üí° **Exemplo Num√©rico:** Para o primeiro trimestre do segundo ano, temos $Y_t = 130$. A tend√™ncia estimada no tempo $t=5$ √© $T_5 = 110 + 3.5 \times 5 = 127.5$. Assim, a s√©rie sem tend√™ncia √© $Y_5 / T_5 = 130 / 127.5 \approx 1.02$. Ao remover a sazonalidade (√≠ndice 0.97), obtemos $1.02/0.97 \approx 1.05$, que representa a componente de ciclo e ru√≠do.
> 
> | Trimestre | Ano  |  $Y_t$ | $T_t = 110 + 3.5x$  | $Y_t/T_t$ | $S_t$ | $(Y_t/T_t)/S_t$ |
> |-----------|------|--------|-------------------|----------|-------|-------------------|
> | Q1        | 1    |  120   |  113.5            |    1.05   | 0.97  | 1.08   |
> | Q2        | 1    |  150   |  117            |    1.28   | 1.19  | 1.08    |
> | Q3        | 1    |  90    |  120.5           |    0.75   | 0.73  | 1.03   |
> | Q4        | 1    |  140   |  124             |    1.13   | 1.11  |  1.02  |
> | Q1        | 2    |  130   |  127.5            |    1.02   | 0.97  | 1.05   |
> | Q2        | 2    |  160   |  131             |    1.22   | 1.19  |  1.03  |
> | Q3        | 2    |  100   |  134.5           |    0.74   | 0.73  | 1.01   |
> | Q4        | 2    |  150   |  138             |    1.09   | 1.11  |  0.98  |
> | Q1        | 3    |  145   |  141.5            |    1.02   | 0.97  | 1.05  |
> | Q2        | 3    |  175   |  145             |    1.21   | 1.19  | 1.02   |
> | Q3        | 3    |  110   |  148.5            |    0.74   | 0.73  | 1.01   |
> | Q4        | 3    |  165   |  152             |    1.09   | 1.11  | 0.98   |

> A tabela acima apresenta os c√°lculos completos para o exemplo num√©rico usando decomposi√ß√£o multiplicativa.
>
> üí° **Interpreta√ß√£o:**  Os valores na coluna $(Y_t/T_t)/S_t$ representam o componente residual (ciclo + ru√≠do) ap√≥s a remo√ß√£o da tend√™ncia e da sazonalidade. Valores pr√≥ximos de 1 indicam que o modelo captura bem os padr√µes sazonais e de tend√™ncia. Varia√ß√µes maiores (para cima ou para baixo) podem indicar ciclos econ√¥micos ou outros efeitos n√£o modelados.

> **Observa√ß√£o 2.** O processo apresentado acima, a despeito da explica√ß√£o, √© bastante simplificado. Na pr√°tica, s√£o utilizadas outras t√©cnicas, tais como ajuste por m√©dias m√≥veis para estimar a tend√™ncia, ou suaviza√ß√£o exponencial.

**Lema 1.** *A qualidade da decomposi√ß√£o cl√°ssica depende fortemente da precis√£o da estimativa da tend√™ncia e da sazonalidade. Uma m√° estimativa da tend√™ncia ou sazonalidade pode resultar em um componente residual (ru√≠do e ciclo) que ainda cont√©m padr√µes sistem√°ticos.*
   
   *Estrat√©gia de Prova:*  Este lema n√£o requer uma prova formal, mas √© uma observa√ß√£o fundamental sobre a natureza da decomposi√ß√£o cl√°ssica. A precis√£o da decomposi√ß√£o depende intrinsecamente da qualidade das estimativas das componentes de tend√™ncia e sazonalidade. Uma estimativa incorreta da tend√™ncia levar√° a uma remo√ß√£o inadequada da tend√™ncia, resultando em erros na identifica√ß√£o da sazonalidade, e vice-versa. Da mesma forma, estimativas ruins de ambos levar√£o a componentes residuais que cont√©m parte da tend√™ncia ou da sazonalidade que n√£o foi devidamente removida.

#### An√°lise Funcional e An√°lise Espectral
Para an√°lises mais avan√ßadas, podemos usar t√©cnicas de an√°lise funcional e an√°lise espectral, que proporcionam uma vis√£o mais detalhada da estrutura da s√©rie temporal.

1.  **An√°lise Funcional:** A an√°lise funcional trata as s√©ries temporais como fun√ß√µes, permitindo a aplica√ß√£o de ferramentas matem√°ticas para decompor e modelar essas fun√ß√µes. Isso pode envolver transforma√ß√µes como a Transformada de Fourier, que decomp√µe a s√©rie em componentes de frequ√™ncia.
    
     A transformada de Fourier decomp√µe a s√©rie temporal em uma soma de senos e cossenos de diferentes frequ√™ncias, cada um com uma amplitude e fase espec√≠ficas. Isso permite identificar padr√µes peri√≥dicos na s√©rie temporal. A transformada de Fourier para uma s√©rie temporal discreta *y[n]* √© dada por:
    $$Y[k] = \sum_{n=0}^{N-1} y[n] e^{-j2\pi kn/N}$$
     Onde *Y[k]* √© o coeficiente de Fourier na frequ√™ncia *k*, *N* √© o comprimento da s√©rie temporal, e *j* √© a unidade imagin√°ria.

    > üí° **Exemplo Num√©rico:** Considere uma s√©rie temporal de 8 pontos representando uma onda senoidal com ru√≠do: `y = [1.1, 2.8, 4.9, 6.1, 5.2, 3.0, 0.9, 0.1]`. Aplicando a transformada de Fourier discreta (DFT) usando Python com `numpy`, obtemos os coeficientes de frequ√™ncia.
    ```python
    import numpy as np
    y = np.array([1.1, 2.8, 4.9, 6.1, 5.2, 3.0, 0.9, 0.1])
    Y = np.fft.fft(y)
    print(Y)
    ```
    ```
    [24.1+0.j         -2.33137085-4.37168461j -1.23137085+1.49168461j
     0.23137085+0.45831539j  0.3-0.j         0.23137085-0.45831539j
    -1.23137085-1.49168461j -2.33137085+4.37168461j]
    ```
    > Os coeficientes `Y` mostram as amplitudes e fases das diferentes frequ√™ncias que comp√µem a s√©rie temporal `y`. O primeiro valor (24.1) corresponde √† componente de frequ√™ncia zero, ou seja, a m√©dia dos valores de y. Os outros valores correspondem √†s componentes senoidais com diferentes frequ√™ncias. Note que, como a s√©rie √© real, os coeficientes s√£o sim√©tricos em rela√ß√£o √† metade do array.
    >
    > üí° **Visualiza√ß√£o:** Um gr√°fico com as magnitudes dos coeficientes de Fourier $|Y[k]|$ ajudaria a identificar as frequ√™ncias dominantes na s√©rie temporal.

    A principal vantagem da an√°lise funcional √© a capacidade de identificar padr√µes n√£o intuitivos ou componentes complexos que n√£o s√£o capturados por m√©todos tradicionais.

2.  **An√°lise Espectral:** A an√°lise espectral, tamb√©m conhecida como an√°lise de frequ√™ncia, examina a distribui√ß√£o de energia em diferentes frequ√™ncias dentro da s√©rie temporal. Isso permite identificar frequ√™ncias dominantes que correspondem a ciclos ou sazonalidades importantes.
      
    O espectro de pot√™ncia √© o quadrado da magnitude da transformada de Fourier:
    $$P[k] = |Y[k]|^2$$
    O espectro de pot√™ncia mostra quais frequ√™ncias contribuem mais para a variabilidade da s√©rie temporal. Picos no espectro indicam frequ√™ncias correspondentes a padr√µes peri√≥dicos significativos.
    
    Na an√°lise espectral, a densidade espectral de pot√™ncia (PSD) √© usada para estimar a pot√™ncia do sinal em diferentes frequ√™ncias. Para uma s√©rie temporal discreta *y[n]*, a PSD √© calculada como a transformada de Fourier da fun√ß√£o de autocorrela√ß√£o:
     $$R[m] = \frac{1}{N} \sum_{n=0}^{N-1} y[n] y[n+m]$$
    $$S(f) = \sum_{m=-\infty}^\infty R[m] e^{-j2\pi fm}$$

    > üí° **Exemplo Num√©rico:** Usando os mesmos dados da an√°lise funcional, calculamos o espectro de pot√™ncia:
    ```python
    import numpy as np
    y = np.array([1.1, 2.8, 4.9, 6.1, 5.2, 3.0, 0.9, 0.1])
    Y = np.fft.fft(y)
    P = np.abs(Y)**2
    print(P)
    ```
    ```
    [580.81         31.35289425   3.88052614   0.21198103    0.09
      0.21198103   3.88052614  31.35289425]
    ```
    > O espectro de pot√™ncia `P` mostra que a maior parte da energia do sinal est√° na frequ√™ncia 0 (m√©dia), e uma quantidade consider√°vel est√° nas frequ√™ncias 1 e 7 (sim√©tricas por se tratar de um sinal real). Essas frequ√™ncias podem corresponder a padr√µes importantes na s√©rie temporal.
    >
    > üí° **Visualiza√ß√£o:** Um gr√°fico do espectro de pot√™ncia em fun√ß√£o da frequ√™ncia ajudaria a identificar as frequ√™ncias dominantes. Picos agudos indicam fortes padr√µes peri√≥dicos.
    
    A an√°lise espectral √© particularmente √∫til quando os ciclos ou padr√µes sazonais n√£o s√£o claros ou quando a s√©rie temporal exibe varia√ß√µes n√£o uniformes.
    
    Ambas as t√©cnicas (An√°lise Funcional e Espectral) s√£o poderosas, mas seu uso requer um conhecimento matem√°tico mais profundo e experi√™ncia em an√°lise de s√©ries temporais.
    
**Teorema 1.** (Teorema de Wiener-Khinchin) *A densidade espectral de pot√™ncia (PSD) de um processo estoc√°stico estacion√°rio √© a transformada de Fourier de sua fun√ß√£o de autocorrela√ß√£o. Ou seja, o espectro de pot√™ncia e a fun√ß√£o de autocorrela√ß√£o cont√™m a mesma informa√ß√£o, mas em dom√≠nios diferentes, frequ√™ncia e tempo, respectivamente.*
    
    *Prova:*
    I. Seja $y[n]$ um processo estoc√°stico estacion√°rio com fun√ß√£o de autocorrela√ß√£o $R[m]$ definida como:
        $$R[m] = E[y[n]y[n+m]]$$
        onde E[.] denota o valor esperado.

    II. A densidade espectral de pot√™ncia (PSD), $S(f)$, √© definida como a transformada de Fourier da fun√ß√£o de autocorrela√ß√£o:
        $$S(f) = \sum_{m=-\infty}^{\infty} R[m] e^{-j2\pi fm}$$

    III. Vamos agora derivar a fun√ß√£o de autocorrela√ß√£o em termos da transformada de Fourier. Primeiro, considere a transformada de Fourier de *y[n]*, denotada por $Y(f)$:
         $$Y(f) = \sum_{n=-\infty}^{\infty} y[n] e^{-j2\pi fn}$$
    
    IV. A inversa da transformada de Fourier √© dada por:
         $$y[n] = \int_{-\frac{1}{2}}^{\frac{1}{2}} Y(f) e^{j2\pi fn} df$$

    V. Substitu√≠mos as equa√ß√µes em (IV) na defini√ß√£o de $R[m]$ em (I):
        $$R[m] = E\left[\int_{-\frac{1}{2}}^{\frac{1}{2}} Y(f) e^{j2\pi fn} df \int_{-\frac{1}{2}}^{\frac{1}{2}} Y^*(f') e^{-j2\pi f'(n+m)} df'\right]$$
        
        onde $Y^*(f')$ √© o conjugado complexo de $Y(f')$.

    VI. Trocando a ordem do valor esperado e das integrais:
        $$R[m] = \int_{-\frac{1}{2}}^{\frac{1}{2}} \int_{-\frac{1}{2}}^{\frac{1}{2}} E[Y(f)Y^*(f')]e^{j2\pi(fn - f'(n+m))} df df'$$
        
        Pela defini√ß√£o de estacionaridade, $E[Y(f)Y^*(f')] = S(f)\delta(f-f')$, onde $\delta(f-f')$ √© a fun√ß√£o delta de Dirac.

    VII. Substituindo esta rela√ß√£o na equa√ß√£o de $R[m]$:
         $$R[m] = \int_{-\frac{1}{2}}^{\frac{1}{2}} S(f) e^{-j2\pi fm} df$$

    VIII. A equa√ß√£o acima mostra que a fun√ß√£o de autocorrela√ß√£o √© a transformada inversa de Fourier da densidade espectral de pot√™ncia (PSD). Tomando a transformada de Fourier de ambos os lados, obtemos a rela√ß√£o original de $S(f)$ em (II).
    Portanto, a densidade espectral de pot√™ncia $S(f)$ √© a transformada de Fourier da fun√ß√£o de autocorrela√ß√£o $R[m]$, o que prova o teorema de Wiener-Khinchin. ‚ñ†

### Conclus√£o
A decomposi√ß√£o de s√©ries temporais √© uma ferramenta essencial para qualquer an√°lise de previs√£o de demanda [^4]. Ao isolar os componentes de tend√™ncia, sazonalidade, ciclo e ru√≠do, podemos modelar cada um deles de forma mais precisa e obter previs√µes mais acuradas e robustas [^18, 19]. Al√©m das t√©cnicas cl√°ssicas, m√©todos avan√ßados como a an√°lise funcional e espectral podem fornecer insights valiosos sobre a estrutura das s√©ries temporais [^18]. A escolha da t√©cnica de decomposi√ß√£o mais apropriada depende do tipo de dados dispon√≠veis, dos objetivos da an√°lise e do conhecimento e experi√™ncia do analista.

### Refer√™ncias
[^1]: Cap√≠tulo anterior sobre t√©cnicas de previs√£o
[^4]: Trecho do texto que introduz os componentes da s√©rie temporal (tend√™ncia, ciclo, sazonalidade, varia√ß√£o irregular) e a import√¢ncia de analisar a sazonalidade para uma previs√£o eficaz.
[^18]: Trecho do texto que introduz a modelagem sazonal usando √≠ndices sazonais e as abordagens aditivas e multiplicativas. O texto tamb√©m indica que o modelo multiplicativo √© mais usado nas ind√∫strias.
[^19]: Trecho do texto que detalha os passos para calcular os √≠ndices sazonais e como us√°-los para ajuste de previs√µes.
<!-- END -->
