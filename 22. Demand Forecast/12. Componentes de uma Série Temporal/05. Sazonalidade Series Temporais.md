## Decomposi√ß√£o de S√©ries Temporais: An√°lise Aprofundada da Componente de Sazonalidade

### Introdu√ß√£o
Este cap√≠tulo aprofunda a an√°lise da componente de **sazonalidade** em s√©ries temporais, um padr√£o que se repete em intervalos regulares, como di√°rios, semanais, mensais ou anuais [^3, ^4]. A modelagem precisa da sazonalidade √© crucial para previs√µes acuradas, permitindo que as organiza√ß√µes de sa√∫de ajustem sua capacidade de resposta de acordo com as flutua√ß√µes da demanda [^4]. Exploraremos as diferen√ßas entre modelos aditivos e multiplicativos, bem como t√©cnicas de ajuste sazonal, incluindo a utiliza√ß√£o de **√≠ndices sazonais** e a aplica√ß√£o da transformada de Fourier. Tamb√©m discutiremos como o **Filtro de Kalman** pode ser aplicado em modelos de espa√ßo de estados para lidar com a sazonalidade.

### Modelos Aditivos e Multiplicativos para Sazonalidade

A componente sazonal pode ser modelada utilizando abordagens **aditivas** ou **multiplicativas**. A escolha entre elas depende da natureza da s√©rie temporal e de como a componente sazonal interage com a tend√™ncia e outros componentes.

#### Modelos Aditivos
Em um modelo aditivo, a componente sazonal √© adicionada √† tend√™ncia e outras componentes. A s√©rie temporal √© expressa como:
$$Y_t = T_t + S_t + I_t$$
onde:
-   $Y_t$ √© o valor da s√©rie temporal no instante $t$.
-   $T_t$ √© a componente de tend√™ncia no tempo $t$.
-   $S_t$ √© a componente sazonal no tempo $t$.
-  $I_t$ √© a componente irregular (ru√≠do) no tempo $t$.
Em modelos aditivos, a componente sazonal √© expressa em unidades da s√©rie temporal e assume-se que a amplitude da sazonalidade √© constante ao longo do tempo. A componente sazonal pode ser modelada atrav√©s de uma s√©rie de valores que se repetem ao longo do tempo. Em geral, um modelo aditivo assume uma varia√ß√£o sazonal constante, que n√£o depende dos valores m√©dios da s√©rie temporal.
> üí° **Exemplo Num√©rico:** Suponha que temos dados mensais de pacientes com uma tend√™ncia linear, tal que a demanda aumenta em 10 pacientes por m√™s, e um padr√£o sazonal de amplitude fixa em cada m√™s, em rela√ß√£o a uma m√©dia mensal de 100 pacientes:
>
> | M√™s    | Tend√™ncia   | Sazonalidade   | Irregularidade | Demanda   |
> |--------|-------------|---------------|-----------------|-----------|
> | Janeiro  | 100    | -10     | 3    | 93   |
> | Fevereiro | 110   | -5   | -1       | 104      |
> | Mar√ßo    | 120     | 0    | 2   | 122    |
> | Abril    | 130  | 5   | -2    | 133      |
> | Maio    | 140 |  10    | 1       | 151     |
> | Junho | 150   | 5 | -1   | 154   |
> | Julho | 160   |  0    | 2   | 162     |
> | Agosto    | 170     | -5   | -1   | 164    |
> | Setembro | 180     | -10   | 0     | 170      |
> | Outubro  | 190    | -5    | 2   | 187     |
> | Novembro   | 200     |  0  | -2   | 198    |
> | Dezembro  | 210 | 5   | 1   | 216   |
>
> Neste cen√°rio, a componente sazonal (S) √© adicionada √† tend√™ncia (T), e os res√≠duos (I) s√£o adicionados tamb√©m. A componente sazonal √© um valor fixo que se repete a cada ano, indicando que em janeiro a demanda √© 10 pacientes menor do que o valor dado pela tend√™ncia, em maio √© 10 pacientes maior, etc. O modelo aditivo assume que a amplitude do padr√£o sazonal (10 pacientes) √© constante ao longo do tempo, ou seja, independe da magnitude da tend√™ncia.

#### Modelos Multiplicativos

Em um modelo multiplicativo, a componente sazonal √© multiplicada pela tend√™ncia e outras componentes. A s√©rie temporal √© expressa como:
$$Y_t = T_t \times S_t \times I_t$$
onde:
-   $Y_t$ √© o valor da s√©rie temporal no instante $t$.
-   $T_t$ √© a componente de tend√™ncia no tempo $t$.
-   $S_t$ √© a componente sazonal no tempo $t$, que neste caso √© um √≠ndice sazonal.
-   $I_t$ √© a componente irregular (ru√≠do) no tempo $t$.
Em modelos multiplicativos, a componente sazonal √© expressa como um percentual da tend√™ncia, e se assume que a amplitude da componente sazonal aumenta (ou diminui) proporcionalmente √† tend√™ncia. Os valores da componente sazonal s√£o √≠ndices que indicam a porcentagem acima ou abaixo da tend√™ncia. Um √≠ndice de 1.1 indica que a demanda √© 10% maior que a tend√™ncia, e um √≠ndice de 0.9 indica que a demanda √© 10% menor.
> üí° **Exemplo Num√©rico:** Usando o mesmo exemplo anterior, com uma tend√™ncia linear e uma componente sazonal, podemos aplicar uma abordagem multiplicativa, agora utilizando um √≠ndice sazonal, de forma que a demanda √© proporcional a essa tend√™ncia:
>
> | M√™s    | Tend√™ncia   | √çndice Sazonal   | Irregularidade | Demanda   |
> |--------|-------------|---------------|-----------------|-----------|
> | Janeiro  | 100    | 0.9     | 1.03   | 92.7   |
> | Fevereiro | 110   | 0.95   | 0.99       | 103.3   |
> | Mar√ßo    | 120     | 1    | 1.02   | 122.4  |
> | Abril    | 130  | 1.05   | 0.98    | 133.3  |
> | Maio    | 140 |  1.1    | 1.01       | 155.5   |
> | Junho | 150   | 1.05 | 0.99   | 155.9  |
> | Julho | 160   |  1    | 1.02   | 163.2  |
> | Agosto    | 170     | 0.95   | 0.99   | 159.6  |
> | Setembro | 180     | 0.9   | 1    | 162   |
> | Outubro  | 190    | 0.95    | 1.02   | 183.6   |
> | Novembro   | 200     |  1  | 0.98  | 196   |
> | Dezembro  | 210 | 1.05   | 1.01   | 223.4    |
>
> Em um modelo multiplicativo, a sazonalidade (S), expressa como um √≠ndice, modifica a tend√™ncia (T). Os valores da componente sazonal indicam que em janeiro, a demanda √© 10% menor do que a tend√™ncia, enquanto em maio √© 10% maior. A amplitude da sazonalidade aumenta com a tend√™ncia, ou seja, o impacto da sazonalidade √© proporcional √† demanda. Modelos multiplicativos s√£o mais apropriados para a grande maioria das s√©ries temporais.

**Lema 1.1:** Em situa√ß√µes onde a componente sazonal √© pequena em rela√ß√£o √† tend√™ncia e outras componentes, e sua amplitude permanece relativamente constante, um modelo aditivo √© apropriado. Por outro lado, quando a componente sazonal varia proporcionalmente com a tend√™ncia, um modelo multiplicativo √© mais adequado.

**Prova do Lema 1.1:**
I.  Um modelo aditivo assume que a componente sazonal √© independente da tend√™ncia e outras componentes, de forma que a amplitude da sazonalidade permanece constante ao longo do tempo. Isso √© apropriado quando a sazonalidade representa pequenas varia√ß√µes em torno de um valor base.
II.  Um modelo multiplicativo assume que a componente sazonal √© proporcional √† tend√™ncia, resultando em amplitudes sazonais maiores quando a tend√™ncia √© maior, e amplitudes menores quando a tend√™ncia √© menor.  Isso √© apropriado quando o impacto da sazonalidade varia com o n√≠vel da demanda.
III. Assim, a escolha do modelo depender√° da rela√ß√£o entre a sazonalidade e outras componentes da s√©rie temporal. Modelos aditivos s√£o adequados quando a sazonalidade √© pequena e constante, enquanto modelos multiplicativos s√£o prefer√≠veis quando a sazonalidade varia com a tend√™ncia.‚ñ†

**Teorema 1.1** *Transforma√ß√£o para Estabiliza√ß√£o da Vari√¢ncia*:  Em situa√ß√µes onde a amplitude da componente sazonal aumenta com o n√≠vel da s√©rie temporal, uma transforma√ß√£o logar√≠tmica pode transformar um modelo multiplicativo em um modelo aditivo, facilitando a an√°lise e modelagem.

**Prova do Teorema 1.1:**
I. Considere o modelo multiplicativo:
$$Y_t = T_t \times S_t \times I_t$$

II. Aplicando o logaritmo natural em ambos os lados da equa√ß√£o:
$$\ln(Y_t) = \ln(T_t \times S_t \times I_t)$$
$$\ln(Y_t) = \ln(T_t) + \ln(S_t) + \ln(I_t)$$

III. Definindo:
$Y'_t = \ln(Y_t)$
$T'_t = \ln(T_t)$
$S'_t = \ln(S_t)$
$I'_t = \ln(I_t)$

IV. O modelo transformado √© ent√£o:
$$Y'_t = T'_t + S'_t + I'_t$$

V. O modelo transformado agora tem a forma de um modelo aditivo, onde a componente sazonal e o ru√≠do s√£o adicionados √† tend√™ncia. O logaritmo tem a propriedade de estabilizar a vari√¢ncia, tornando um modelo multiplicativo mais f√°cil de modelar.‚ñ†

### Ajuste Sazonal e √çndices Sazonais

O ajuste sazonal √© o processo de remover a componente sazonal de uma s√©rie temporal, revelando a tend√™ncia subjacente e outros padr√µes n√£o sazonais. Isso √© crucial para comparar valores de diferentes per√≠odos sazonalmente e para analisar a componente de ciclo. Os √≠ndices sazonais s√£o calculados para quantificar o impacto da sazonalidade em cada per√≠odo e s√£o usados para ajustar a s√©rie temporal.
Os √≠ndices sazonais s√£o usados para:
1. **Deseasonalizar:** Remover a componente sazonal da s√©rie, permitindo a an√°lise de outros padr√µes.
2. **Previs√£o:** Incorporar padr√µes sazonais nas previs√µes de demanda.

#### C√°lculo de √çndices Sazonais (Abordagem Multiplicativa)
1. **Calcular a m√©dia da demanda para cada per√≠odo sazonal:**
    - Para dados mensais, calcular a m√©dia da demanda para cada m√™s ao longo de v√°rios anos. Para dados trimestrais, calcular a m√©dia da demanda por trimestre ao longo de v√°rios anos.
2. **Calcular a m√©dia geral da demanda:** Calcular a m√©dia de todas as m√©dias sazonais calculadas no passo 1.
3.  **Calcular o √≠ndice sazonal para cada per√≠odo:** Dividir a m√©dia da demanda para cada per√≠odo sazonal pela m√©dia geral da demanda.
    $$√çndice Sazonal_i = \frac{\text{M√©dia da Demanda no Per√≠odo Sazonal}_i}{\text{M√©dia Geral da Demanda}}$$
4. **Ajustar os dados:** Deseasonalizar a s√©rie temporal dividindo cada ponto de dados pelo √≠ndice sazonal correspondente.

> üí° **Exemplo Num√©rico:** Vamos usar dados trimestrais de demanda, e usar uma abordagem multiplicativa para calcular os √≠ndices sazonais.
>
> | Ano    | Trimestre 1  | Trimestre 2 | Trimestre 3 | Trimestre 4 |
> |--------|-------------|------------|-------------|-------------|
> | 2020  | 120    | 150    | 130   | 90   |
> | 2021   | 130    | 160   | 140   | 100   |
> | 2022    | 140    | 170    | 150   | 110  |
>
> 1. **Calcular as m√©dias trimestrais:**
>    - M√©dia Trimestre 1: (120 + 130 + 140)/3 = 130
>    - M√©dia Trimestre 2: (150 + 160 + 170)/3 = 160
>    - M√©dia Trimestre 3: (130 + 140 + 150)/3 = 140
>    - M√©dia Trimestre 4: (90 + 100 + 110)/3 = 100
>
> 2. **Calcular a m√©dia geral:**
>     - M√©dia geral = (130 + 160 + 140 + 100)/4 = 132.5
>
> 3. **Calcular os √≠ndices sazonais:**
>    - √çndice Trimestre 1: 130/132.5 = 0.98
>    - √çndice Trimestre 2: 160/132.5 = 1.21
>    - √çndice Trimestre 3: 140/132.5 = 1.06
>    - √çndice Trimestre 4: 100/132.5 = 0.75
>
> 4. **Deseasonaliza√ß√£o:** Dividimos cada observa√ß√£o pelo √≠ndice sazonal:
>
> - Demanda deseasonalizada no trimestre 1 de 2020: 120/0.98 = 122.4
> - Demanda deseasonalizada no trimestre 2 de 2020: 150/1.21 = 124.0
> - Demanda deseasonalizada no trimestre 3 de 2020: 130/1.06 = 122.6
> - Demanda deseasonalizada no trimestre 4 de 2020: 90/0.75 = 120
> ... e assim por diante para todos os dados.

**Lema 2.1:** A m√©dia dos √≠ndices sazonais em um ciclo completo (por exemplo, um ano) √© igual a 1 quando a sazonalidade √© modelada como um fator multiplicativo, e √© igual a 0 quando a sazonalidade √© modelada aditivamente.

**Prova do Lema 2.1:**
I.  Em um modelo multiplicativo, os √≠ndices sazonais representam o fator multiplicador em rela√ß√£o √† tend√™ncia ou m√©dia. O c√°lculo dos √≠ndices sazonais usa a m√©dia da s√©rie no numerador e a m√©dia global da s√©rie no denominador. Portanto, a m√©dia dos √≠ndices sazonais num ciclo completo √©:
    $$ \frac{1}{n} \sum_{i=1}^n \frac{m√©dia\_sazonal_i}{m√©dia\_global} = \frac{1}{n} \frac{\sum_{i=1}^n m√©dia\_sazonal_i}{m√©dia\_global} = \frac{1}{n} \frac{n \times m√©dia\_global}{m√©dia\_global} = 1 $$
onde $n$ √© o n√∫mero de per√≠odos sazonais.

II. Em um modelo aditivo, os √≠ndices sazonais representam a diferen√ßa em rela√ß√£o ao valor da tend√™ncia ou m√©dia. Se as diferen√ßas s√£o calculadas em rela√ß√£o a uma m√©dia global, ent√£o a m√©dia das diferen√ßas √© nula:
    $$ \frac{1}{n} \sum_{i=1}^n (m√©dia\_sazonal_i - m√©dia\_global) =  \frac{1}{n} (\sum_{i=1}^n m√©dia\_sazonal_i - n \times m√©dia\_global) =  \frac{1}{n} (n \times m√©dia\_global - n \times m√©dia\_global) = 0$$
III. Portanto, num modelo multiplicativo, os √≠ndices sazonais t√™m m√©dia 1, enquanto em modelos aditivos t√™m m√©dia 0, mostrando uma diferen√ßa chave na interpreta√ß√£o das duas abordagens.‚ñ†

**Teorema 2.1:** *Deseasonaliza√ß√£o com √çndices Sazonais*: Se a s√©rie temporal $Y_t$ √© decomposta como $Y_t = T_t \times S_t \times I_t$ em um modelo multiplicativo, ent√£o a s√©rie deseasonalizada $\hat{Y}_t$ √© obtida atrav√©s da divis√£o pelos √≠ndices sazonais $S_t$: $\hat{Y}_t = \frac{Y_t}{S_t}$, resultando em uma s√©rie que aproxima-se de $T_t \times I_t$. Similarmente, em um modelo aditivo $Y_t = T_t + S_t + I_t$, a s√©rie deseasonalizada $\hat{Y}_t$ √© obtida subtraindo-se $S_t$: $\hat{Y}_t = Y_t - S_t$, resultando em uma s√©rie que aproxima-se de $T_t + I_t$.

**Prova do Teorema 2.1:**
I. No modelo multiplicativo $Y_t = T_t \times S_t \times I_t$, dividindo a s√©rie temporal pelos √≠ndices sazonais $S_t$:
$$\hat{Y}_t = \frac{Y_t}{S_t} = \frac{T_t \times S_t \times I_t}{S_t} = T_t \times I_t$$
Este processo remove a componente sazonal, restando a tend√™ncia e a componente irregular.

II. No modelo aditivo $Y_t = T_t + S_t + I_t$, subtraindo a componente sazonal $S_t$ da s√©rie temporal:
$$\hat{Y}_t = Y_t - S_t = T_t + S_t + I_t - S_t = T_t + I_t$$
Similarmente, este processo remove a componente sazonal, restando a tend√™ncia e a componente irregular.

III. Portanto, a deseasonaliza√ß√£o remove a componente sazonal, deixando a tend√™ncia e o ru√≠do em ambos os modelos. Em um modelo multiplicativo, a remo√ß√£o √© feita por divis√£o, e em um modelo aditivo, a remo√ß√£o √© feita por subtra√ß√£o.‚ñ†

#### Ajuste Sazonal usando a Transformada de Fourier
A Transformada de Fourier Discreta (DFT) pode ser utilizada para extrair as componentes de frequ√™ncia da s√©rie temporal.  A componente sazonal se manifestar√° como um pico na frequ√™ncia correspondente ao per√≠odo sazonal.  As componentes de frequ√™ncia podem ser isoladas e usadas para modelar a sazonalidade da s√©rie temporal. Em particular, usando a transformada inversa da transformada de Fourier (IDFT) podemos reconstruir apenas a componente sazonal da s√©rie temporal. O ajuste sazonal ent√£o consistiria em remover ou atenuar essas componentes.

> üí° **Exemplo Num√©rico:** Criemos uma s√©rie temporal com sazonalidade, transformemos no dom√≠nio da frequ√™ncia usando a DFT, identifiquemos a componente de frequ√™ncia correspondente √† sazonalidade, e a reconstruamos usando a IDFT.
```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, ifft

# Dados com sazonalidade
N = 100
t = np.arange(N)
periodo_sazonal = 20
y = 5 * np.sin(2 * np.pi * t / periodo_sazonal) + np.random.normal(0,1,N) + 0.2*t # sinusoide + ruido + tendencia

# Calcular a DFT
fft_result = fft(y)

# Calcular frequ√™ncias
frequencias = np.fft.fftfreq(N)

# Filtro (removendo outras frequencias)
num_harmonics = 1  # Numero de componentes de frequencia
mask = np.zeros_like(fft_result, dtype=bool)
mask[0:num_harmonics+1] = True
mask[N-num_harmonics:N] = True
fft_filtered = fft_result*mask

# Aplicar a IDFT para reconstruir apenas a componente sazonal
y_sazonal = ifft(fft_filtered)

# Deseasonalizar (removendo componente sazonal)
y_deseasonalizada = y - y_sazonal

# Plotar resultados
plt.figure(figsize=(10, 6))
plt.plot(t, y, label="S√©rie temporal original")
plt.plot(t, y_sazonal.real, color='red', label="Componente Sazonal")
plt.plot(t, y_deseasonalizada.real, color='green', label="S√©rie Deseasonalizada")
plt.legend()
plt.title("Ajuste Sazonal com DFT e IDFT")
plt.xlabel("Tempo")
plt.ylabel("Valor")
plt.show()
```
O gr√°fico mostra como a DFT e IDFT podem ser usadas para extrair a componente sazonal, que pode ser removida da s√©rie temporal original. A serie deseasonalizada remove o padrao sazonal.

### Filtro de Kalman em Modelos de Espa√ßo de Estados para Sazonalidade
O **Filtro de Kalman**, em conjunto com os **modelos de espa√ßo de estados**, fornece uma estrutura poderosa para lidar com sistemas din√¢micos que incluem componentes sazonais. Em vez de tratar a sazonalidade como um padr√£o fixo, como na modelagem por √≠ndices sazonais, o filtro de Kalman permite que o padr√£o sazonal se adapte ao longo do tempo. Em um modelo de espa√ßo de estados, definimos um vetor de estado que inclui a sazonalidade e outras componentes da s√©rie temporal.

Para modelar a sazonalidade, podemos expandir o vetor de estado para incluir, por exemplo, o componente sazonal por meio de vari√°veis dummies:
$$ \mathbf{x}_t = \begin{bmatrix} \text{n√≠vel}_t \\ \text{tend√™ncia}_t \\ \text{sazonalidade}_{t} \end{bmatrix} $$
Onde o componente de sazonalidade pode ser um conjunto de vari√°veis dummies (indicadoras) que representam os diferentes per√≠odos sazonais (por exemplo, os 12 meses do ano). A matriz de transi√ß√£o de estado $\mathbf{F}$ e as matrizes de observa√ß√£o $\mathbf{H}$ seriam constru√≠das para modelar como os componentes de n√≠vel, tend√™ncia e sazonalidade evoluem ao longo do tempo e contribuem para a observa√ß√£o da s√©rie temporal. As equa√ß√µes do filtro de Kalman seriam usadas para estimar iterativamente esses componentes e obter as previs√µes.

O Filtro de Kalman permite que o padr√£o sazonal se ajuste a mudan√ßas na estrutura temporal. Isso √© mais flex√≠vel do que abordagens que assumem uma componente sazonal fixa, especialmente em situa√ß√µes onde o padr√£o sazonal evolui com o tempo. Modelos de espa√ßo de estados, em conjunto com o filtro de Kalman, s√£o particularmente √∫teis para lidar com s√©ries temporais com componentes c√≠clicas e sazonais e com outras caracter√≠sticas complexas.
O Filtro de Kalman atualiza recursivamente as estimativas dos estados, incluindo sazonalidade, combinando as previs√µes do modelo com as novas observa√ß√µes, o que o torna adequado para sistemas din√¢micos.

> üí° **Exemplo Num√©rico:** Ilustremos o conceito de usar o Filtro de Kalman para sazonalidade com um exemplo simplificado, modelando o n√≠vel e a componente sazonal (sem tend√™ncia) de uma s√©rie temporal com per√≠odo de 4 pontos de dados.
>
> O vetor de estado √© $\mathbf{x}_t = \begin{bmatrix} \text{n√≠vel}_t \\ \text{saz}_1 \\ \text{saz}_2 \\ \text{saz}_3 \end{bmatrix}$, onde saz_1, saz_2 e saz_3 s√£o as componentes sazonais. Assumiremos que a soma das componentes sazonais √© 0.
> As matrizes para o filtro de Kalman neste exemplo s√£o:
> $$ \mathbf{F} = \begin{bmatrix} 1 & 1 & 1 & 1\\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix} $$
> $$ \mathbf{H} = \begin{bmatrix} 1 & 1 & 0 & 0 \end{bmatrix}, \quad \text{para }t=1 \text{ mod }4$$
> $$ \mathbf{H} = \begin{bmatrix} 1 & 0 & 1 & 0 \end{bmatrix}, \quad \text{para }t=2 \text{ mod }4$$
> $$ \mathbf{H} = \begin{bmatrix} 1 & 0 & 0 & 1 \end{bmatrix}, \quad \text{para }t=3 \text{ mod }4$$
> $$ \mathbf{H} = \begin{bmatrix} 1 & -1 & -1 & -1 \end{bmatrix}, \quad \text{para }t=0 \text{ mod }4$$
> Onde a matriz $\mathbf{H}$ seleciona a componente sazonal correspondente a cada per√≠odo. Para simplificar, assumiremos matrizes identidade para ru√≠do do processo $\mathbf{Q}$ e ru√≠do de medi√ß√£o $\mathbf{R}$. As estimativas de estado inicial s√£o definidas com uma m√©dia para o n√≠vel e valor inicial zero para as componentes sazonais. O c√≥digo Python abaixo ilustra como o filtro de Kalman seria implementado para os primeiros pontos da s√©rie temporal:
```python
import numpy as np
import matplotlib.pyplot as plt
from pykalman import KalmanFilter

# Simular dados com sazonalidade
N = 20
t = np.arange(N)
periodo_sazonal = 4
y = 10 * np.sin(2 * np.pi * t / periodo_sazonal) + np.random.normal(0, 1, N)

# Matrizes do filtro de Kalman (simplificado)
F = np.array([[1, 1, 1, 1],
              [0, 1, 0, 0],
              [0, 0, 1, 0],
              [0, 0, 0, 1]])
Q = np.eye(4)*0.1  # Ru√≠do do processo
R = 1.0  # Ru√≠do de medi√ß√£o

# Estado inicial
x0 = np.array([0, 0, 0, 0]) # nivel, saz1, saz2, saz3
P0 = np.eye(4)*10  # Incerteza inicial

# Aplicar filtro de Kalman
estimates = []
kf = KalmanFilter(
    transition_matrices=F,
    observation_matrices=np.array([[1, 1, 0, 0]]), # inicializa√ß√£o ( ser√° alterado no loop)
    initial_state_mean=x0,
    initial_state_covariance=P0,
    transition_covariance=Q,
    observation_covariance=R
)
state_means = []
for i in range(N):
    if i % 4 == 0:
        H = np.array([1, -1, -1, -1]).reshape(1,4)
    elif i % 4 == 1:
        H = np.array([1, 1, 0, 0]).reshape(1,4)
    elif i % 4 == 2:
      H = np.array([1, 0, 1, 0]).reshape(1,4)
    else:
      H = np.array([1, 0, 0, 1]).reshape(1,4)

    kf.observation_matrices = H
    state_mean, state_covariance = kf.filter_update(state_means if len(state_means) >0 else x0,
                                                         P0 if len(state_means) >0 else P0,
                                                         y[i])
    state_means.append(state_mean)
estimates = np.array(state_means)[:,0]
# Visualiza√ß√£o
plt.plot(y, label="Dados Simulados")
plt.plot(estimates, color='red', label="Estimativa Filtro de Kalman")
plt.legend()
plt.show()
```
Este c√≥digo demonstra como a sazonalidade pode ser modelada usando um modelo de espa√ßo de estados e o filtro de Kalman. Ao observar o resultado, notamos que o filtro consegue modelar a sazonalidade. Este √© um exemplo simplificado. Um modelo mais completo pode incluir componentes de tend√™ncia, outras componentes sazonais de diferentes per√≠odos, al√©m de covari√°veis.

**Teorema 3.1** *Converg√™ncia do Filtro de Kalman com Sazonalidade*:  Sob certas condi√ß√µes de observabilidade e controlabilidade do sistema, as estimativas de estado (incluindo a componente sazonal) obtidas pelo filtro de Kalman convergem para os valores verdadeiros dos estados ao longo do tempo, o que significa que a sazonalidade √© modelada de maneira mais precisa com o aumento do n√∫mero de observa√ß√µes.

**Prova do Teorema 3.1 (Esbo√ßo):**
I. A converg√™ncia do filtro de Kalman √© garantida se o sistema √© observ√°vel e control√°vel, ou seja, se todos os estados s√£o afetados pelas observa√ß√µes e control√°veis atrav√©s da evolu√ß√£o do sistema.
II. Observabilidade garante que as observa√ß√µes fornecem informa√ß√£o suficiente para estimar os estados.
III. Controlabilidade garante que o sistema pode evoluir para qualquer estado desejado, permitindo que os estados se ajustem ao longo do tempo.
IV.  Para um sistema com componente sazonal modelado como vari√°veis dummies, se a matriz de observa√ß√£o $\mathbf{H}$ √© constru√≠da de tal forma que cada estado sazonal √© observado pelo menos uma vez, ent√£o o sistema torna-se observ√°vel.
V.  Sob estas condi√ß√µes de observabilidade e controlabilidade, as equa√ß√µes do filtro de Kalman garantem que as estimativas de estado (incluindo a componente sazonal) convergem probabilisticamente para o estado verdadeiro ao longo do tempo. As estimativas de estado s√£o atualizadas recursivamente a cada observa√ß√£o, convergindo para o valor real do estado √† medida que o n√∫mero de observa√ß√µes aumenta, modelando assim a sazonalidade de forma mais precisa.‚ñ†

### Conclus√£o
A modelagem precisa da componente sazonal √© fundamental para a precis√£o das previs√µes de demanda no setor de sa√∫de. A escolha entre modelos aditivos e multiplicativos depende de como a sazonalidade interage com a tend√™ncia. O c√°lculo de √≠ndices sazonais permite ajustar a s√©rie temporal, e a transformada de Fourier pode ser usada para identificar a frequ√™ncia da componente sazonal.  Modelos de espa√ßo de estados com o filtro de Kalman oferecem uma abordagem mais flex√≠vel para lidar com a sazonalidade, permitindo que o padr√£o sazonal evolua com o tempo.  A compreens√£o e aplica√ß√£o dessas t√©cnicas contribuem para decis√µes mais informadas na gest√£o de opera√ß√µes e recursos em sa√∫de, como o planejamento de escalas de pessoal, a compra de materiais e a otimiza√ß√£o da capacidade de atendimento. Nos pr√≥ximos cap√≠tulos, continuaremos explorando os demais componentes de s√©ries temporais, oferecendo uma vis√£o abrangente para a aplica√ß√£o desses modelos.

### Refer√™ncias
[^1]: ... *Cap√≠tulo 3: Forecasting Demand*
[^2]: ... *Box 3.1 OM in Practice!*
[^3]: ... *Componentes of a Time Series*
[^4]: ... *3. Seasonality.*
[^5]: ... *4. Irregular movement.*
[^22.1]: ... *Previous Topics: Decomposi√ß√£o de S√©ries Temporais: Tend√™ncia, Ciclo, Sazonalidade e Irregularidade*
<!-- END -->
