## Modelos de S√©ries Temporais N√£o Estacion√°rias: Diferencia√ß√£o Fracion√°ria e Quebras Ocasionais na Tend√™ncia
### Introdu√ß√£o
Como vimos anteriormente, a an√°lise de s√©ries temporais frequentemente envolve a modelagem de processos n√£o estacion√°rios. Os modelos de s√©ries temporais n√£o estacion√°rias s√£o mais complexos do que os estacion√°rios, pois exigem abordagens que levem em considera√ß√£o tend√™ncias determin√≠sticas ou estoc√°sticas. Os cap√≠tulos anteriores nos introduziram aos modelos trend-stationary, que incluem uma tend√™ncia determin√≠stica, e aos modelos com raiz unit√°ria, que modelam tend√™ncias estoc√°sticas [^1]. Este cap√≠tulo se aprofunda em abordagens alternativas para a modelagem de s√©ries temporais n√£o estacion√°rias, explorando a diferencia√ß√£o fracion√°ria e as quebras ocasionais na tend√™ncia.

### Conceitos Fundamentais

#### Modelos com Diferencia√ß√£o Fracion√°ria
A abordagem de **diferencia√ß√£o fracion√°ria** surge como uma alternativa para modelar s√©ries temporais que exibem depend√™ncias de longo prazo que n√£o s√£o adequadamente capturadas por modelos tradicionais [^1]. Em vez de usar a primeira ou segunda diferen√ßa para tornar uma s√©rie estacion√°ria, como nos modelos com raiz unit√°ria, a diferencia√ß√£o fracion√°ria permite uma integra√ß√£o de ordem n√£o inteira. O modelo geral de um processo integrado de ordem *d* pode ser escrito como:

$$(1-L)^d y_t = \psi(L)\epsilon_t$$ [15.5.1]

onde $L$ √© o operador de defasagem, $\psi(L)$ √© um polin√¥mio em $L$, e $\epsilon_t$ √© um ru√≠do branco [^1]. Tipicamente, assume-se que $d=1$ ou $d=2$, indicando que a primeira ou segunda diferen√ßa da s√©rie √© estacion√°ria. No entanto, conforme apontado por Granger e Joyeux (1980) e Hosking (1981), valores n√£o inteiros de $d$ tamb√©m podem ser √∫teis [^1].

> üí° **Exemplo Num√©rico:** Vamos considerar uma s√©rie temporal simulada que apresenta depend√™ncia de longo prazo. Para isso, usaremos um ru√≠do branco e aplicaremos a diferencia√ß√£o fracion√°ria com d=0.4.
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
>
> # Simula um ru√≠do branco
> np.random.seed(42)
> T = 100
> white_noise = np.random.normal(0, 1, T)
>
> # Fun√ß√£o para calcular os coeficientes h_j
> def fractional_diff_weights(d, length):
>     weights = [1]
>     for j in range(1, length):
>         weights.append(weights[-1] * (j - 1 - d) / j)
>     return np.array(weights)
>
> # Calcula os pesos h_j para d = 0.4
> d = 0.4
> weights = fractional_diff_weights(d, T)
>
> # Aplica a diferencia√ß√£o fracion√°ria
> fractional_diff_series = np.convolve(white_noise, weights, mode='full')[:T]
>
> # Plot das s√©ries
> plt.figure(figsize=(10, 6))
> plt.plot(white_noise, label='Ru√≠do Branco')
> plt.plot(fractional_diff_series, label=f'S√©rie com Diferencia√ß√£o Fracion√°ria (d={d})')
> plt.legend()
> plt.title('S√©rie Temporal Original e com Diferencia√ß√£o Fracion√°ria')
> plt.xlabel('Tempo')
> plt.ylabel('Valor')
> plt.show()
> ```
>
> Este c√≥digo gera um ru√≠do branco e aplica a diferencia√ß√£o fracion√°ria com `d=0.4`. O gr√°fico resultante mostra que a s√©rie diferenciada fracionariamente exibe um comportamento mais suave e depend√™ncias de longo prazo, diferentemente do ru√≠do branco original. Isso ilustra como valores n√£o inteiros de `d` introduzem mem√≥ria de longo prazo.

Para entender o significado de valores n√£o inteiros de $d$, considere a representa√ß√£o MA(‚àû) impl√≠cita na equa√ß√£o [15.5.1]. A equa√ß√£o [15.5.2] mostra que multiplicando ambos os lados de [15.5.1] por $(1-L)^{-d}$ obtemos:

$$y_t = (1-L)^{-d}\psi(L)\epsilon_t$$ [15.5.2]

Para entender como $(1-L)^{-d}$ age, considere a fun√ß√£o $f(z) = (1-z)^{-d}$. Podemos usar expans√£o de Taylor para expressar essa fun√ß√£o como uma s√©rie de pot√™ncias. As derivadas dessa fun√ß√£o s√£o dadas por:

$$\frac{\partial f}{\partial z} = d(1-z)^{-d-1}$$
$$\frac{\partial^2 f}{\partial z^2} = (d+1)d(1-z)^{-d-2}$$
$$\frac{\partial^3 f}{\partial z^3} = (d+2)(d+1)d(1-z)^{-d-3}$$
$$\frac{\partial^j f}{\partial z^j} = (d+j-1)\ldots(d+1)d(1-z)^{-d-j}$$

A expans√£o de s√©rie de pot√™ncia para $f(z)$ em torno de $z=0$ √© dada por:

$$(1-z)^{-d} = f(0) + \frac{1}{1!}\frac{\partial f}{\partial z}|_{z=0}z + \frac{1}{2!}\frac{\partial^2 f}{\partial z^2}|_{z=0}z^2 + \frac{1}{3!}\frac{\partial^3 f}{\partial z^3}|_{z=0}z^3 + \ldots$$

$$= 1 + dz + \frac{(d+1)d}{2!}z^2 + \frac{(d+2)(d+1)d}{3!}z^3 + \ldots$$

Com isso, podemos representar o operador $(1-L)^{-d}$ como um filtro, obtendo a equa√ß√£o [15.5.3]:

$$(1-L)^{-d} = 1 + dL + \frac{(d+1)d}{2!}L^2 + \frac{(d+2)(d+1)d}{3!}L^3 + \ldots = \sum_{j=0}^{\infty} h_jL^j$$ [15.5.3]

onde $h_0 = 1$ e $h_j = \frac{1}{j!}(d+j-1)(d+j-2)\ldots(d+1)d$ [15.5.4]. A equa√ß√£o [15.5.5] estabelece que, para grandes valores de $j$, $h_j$ pode ser aproximado por $h_j \approx (j+1)^{d-1}$ [^1].

A principal diferen√ßa entre o modelo de diferencia√ß√£o fracion√°ria e os modelos ARMA tradicionais est√° na forma como os coeficientes de resposta ao impulso ($h_j$) decaem. Em processos ARMA estacion√°rios, os coeficientes decaem geometricamente, enquanto em processos com diferencia√ß√£o fracion√°ria, decaem de forma mais lenta [^1]. Isso permite que os modelos de diferencia√ß√£o fracion√°ria capturem depend√™ncias de longo prazo nas s√©ries temporais, ou seja, a mem√≥ria longa.

> üí° **Exemplo Num√©rico:** Vamos calcular os primeiros tr√™s coeficientes $h_j$ para $d=0.3$:
>
> $\text{Passo 1: } h_0 = 1$
>
> $\text{Passo 2: } h_1 = \frac{1}{1!}(0.3) = 0.3$
>
> $\text{Passo 3: } h_2 = \frac{1}{2!}(0.3+1)(0.3) = \frac{1}{2}(1.3)(0.3) = 0.195$
>
> Estes coeficientes mostram como o impacto das defasagens $\epsilon_{t-j}$ decresce lentamente com o aumento de $j$. Em modelos ARMA, este decaimento seria muito mais r√°pido, o que ilustra a capacidade da diferencia√ß√£o fracion√°ria de modelar depend√™ncias de longo prazo.

A equa√ß√£o [15.5.6] apresenta o modelo de s√©rie temporal resultante:

$$y_t = (1-L)^{-d}\epsilon_t = h_0\epsilon_t + h_1\epsilon_{t-1} + h_2\epsilon_{t-2} + \ldots$$ [15.5.6]

√â importante notar que a sequ√™ncia dos coeficientes da m√©dia m√≥vel ($h_j$) √© som√°vel ao quadrado se $d< \frac{1}{2}$. Caso contr√°rio, a s√©rie deve ser diferenciada antes de ser modelada usando as equa√ß√µes [15.5.2] e [15.5.6].

**Condi√ß√µes para Integra√ß√£o Fracion√°ria:** A integra√ß√£o fracion√°ria pode surgir devido √† agrega√ß√£o de outros processos. Granger (1980), Geweke e Porter-Hudak (1983) e Sowell (1992) propuseram m√©todos para estimar o par√¢metro $d$. Diebold e Rudebusch (1989) e Lo (1991) aplicaram essa abordagem para analisar a persist√™ncia em dados de PNB e nos pre√ßos de a√ß√µes, respectivamente [^1].

**Lema 1**
A expans√£o do operador $(1-L)^{-d}$ pode ser expressa usando a fun√ß√£o gama.
*Proof:*
Provaremos que $h_j = \frac{1}{j!}(d+j-1)(d+j-2)\ldots(d+1)d$ pode ser expressa usando a fun√ß√£o gama.

I.  Definimos $h_j = \frac{1}{j!}(d+j-1)(d+j-2)\ldots(d+1)d$.

II.  Multiplicamos e dividimos a express√£o por $\Gamma(d)$, onde $\Gamma$ √© a fun√ß√£o gama, para introduzir a forma necess√°ria para a fun√ß√£o gama.

$$h_j = \frac{1}{j!} \frac{(d+j-1)(d+j-2)\ldots(d+1)d \Gamma(d)}{\Gamma(d)}$$

III.  Reconhecemos que $(d+j-1)(d+j-2)\ldots(d+1)d \Gamma(d)$ √© equivalente a $\Gamma(d+j)$.  Portanto:

$$h_j = \frac{\Gamma(d+j)}{j! \Gamma(d)}$$

IV. Usamos a defini√ß√£o de coeficientes binomiais generalizados, que diz que $\binom{n}{k} = \frac{\Gamma(n+1)}{\Gamma(k+1)\Gamma(n-k+1)}$, para expressar $h_j$ na forma de um coeficiente binomial. No nosso caso temos $\binom{d+j-1}{j} = \frac{\Gamma(d+j)}{\Gamma(j+1)\Gamma(d)}$ e $\frac{1}{j!} = \frac{1}{\Gamma(j+1)}$. Assim, temos que

$$h_j = \binom{d+j-1}{j}$$

V. Sabemos que $\binom{n}{k} = (-1)^k \binom{k-n-1}{k}$. Assim, podemos escrever $\binom{d+j-1}{j} = (-1)^j\binom{-d}{j}$. Portanto,

$$h_j =  \binom{-d}{j}(-1)^j$$

VI. Assim, a expans√£o do operador pode ser expressa como:
$$(1-L)^{-d} =  \sum_{j=0}^{\infty} \binom{d+j-1}{j} L^j = \sum_{j=0}^{\infty} \frac{\Gamma(d+j)}{\Gamma(j+1) \Gamma(d)} L^j$$
Isso mostra que os coeficientes $h_j$ podem ser expressos usando a fun√ß√£o gama. ‚ñ†

#### Modelos com Quebras Ocasionais na Tend√™ncia

Outra abordagem para modelar n√£o estacionariedades √© atrav√©s da incorpora√ß√£o de **quebras ocasionais na tend√™ncia**. Ao contr√°rio dos modelos de raiz unit√°ria que assumem que eventos ocorrem constantemente e afetam permanentemente a s√©rie, esta abordagem modela quebras discretas na tend√™ncia [^1]. Um modelo simples com uma quebra pode ser expresso como:

$$y_t = \begin{cases} \alpha_1 + \delta t + \epsilon_t & \text{para } t < T_0 \\ \alpha_2 + \delta t + \epsilon_t & \text{para } t \geq T_0 \end{cases}$$ [15.5.7]

onde $T_0$ √© o tempo da quebra. Este modelo sugere que a s√©rie √© estacion√°ria em torno de uma tend√™ncia com uma quebra no n√≠vel em $T_0$ [^1].  No entanto, a presen√ßa dessas quebras pode levar a s√©rie a parecer ter um comportamento de raiz unit√°ria quando analisada com testes padr√£o [^1].

> üí° **Exemplo Num√©rico:** Considere uma s√©rie temporal com uma quebra no tempo $T_0 = 50$.
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
>
> # Define par√¢metros
> T = 100
> T0 = 50
> alpha1 = 10
> alpha2 = 20
> delta = 0.5
> np.random.seed(42)
> epsilon = np.random.normal(0, 1, T)
>
> # Cria a s√©rie temporal com quebra
> time = np.arange(1, T + 1)
> y = np.zeros(T)
> for t in range(T):
>    if t < T0:
>        y[t] = alpha1 + delta * time[t] + epsilon[t]
>    else:
>        y[t] = alpha2 + delta * time[t] + epsilon[t]
>
> # Plot da s√©rie temporal
> plt.figure(figsize=(10, 6))
> plt.plot(time, y)
> plt.axvline(x=T0, color='r', linestyle='--', label='Quebra na Tend√™ncia')
> plt.title('S√©rie Temporal com Quebra na Tend√™ncia')
> plt.xlabel('Tempo')
> plt.ylabel('Valor')
> plt.legend()
> plt.show()
> ```
>
> O gr√°fico gerado mostra uma clara mudan√ßa no n√≠vel da s√©rie em $T_0=50$, enquanto a inclina√ß√£o da tend√™ncia permanece constante. Este exemplo ilustra como uma quebra na tend√™ncia afeta a s√©rie temporal.

Uma maneira alternativa de pensar sobre este processo √© express√°-lo como:

$$\Delta y_t = \xi_t + \delta + \epsilon_t - \epsilon_{t-1}$$ [15.5.8]

onde $\xi_t = \alpha_2 - \alpha_1$ se $t = T_0$ e 0 caso contr√°rio [^1]. Se $\xi_t$ √© considerada uma vari√°vel aleat√≥ria com distribui√ß√£o de probabilidade dada por:

$$\xi_t = \begin{cases} \alpha_2 - \alpha_1 & \text{com probabilidade } p \\ 0 & \text{com probabilidade } 1 - p \end{cases}$$

onde $p$ √© pequeno, o processo pode ser reescrito como:

$$\Delta y_t = \mu + \eta_t$$ [15.5.9]

onde $\mu = p(\alpha_2 - \alpha_1) + \delta$ e $\eta_t = \xi_t - p(\alpha_2 - \alpha_1) + \epsilon_t - \epsilon_{t-1}$ [^1].  Neste caso, $\eta_t$ √© uma soma de um processo de ru√≠do branco com m√©dia zero e um processo MA(1) independente. Assim, $\Delta y_t$ pode ser expressa como um processo ARIMA(0, 1, 1):

$$\Delta y_t = \mu + \nu_t + \theta\nu_{t-1}$$

onde $\nu_t$ √© uma distribui√ß√£o n√£o-Gaussiana [^1].

A regra de previs√£o linear √≥tima para este processo √© dada por $\mathbb{E}(y_{t+s}|y_t,y_{t-1},\ldots) = \mu s + y_t + \theta\nu_t$, que mostra que as inova√ß√µes  $\nu_t$ t√™m peso que n√£o desaparece conforme $s \to \infty$. Isso implica que a realiza√ß√£o de uma vari√°vel $\xi_t$ tem consequ√™ncias permanentes no n√≠vel da s√©rie.

**Proposi√ß√£o 1**
A presen√ßa de quebras na tend√™ncia pode levar a um vi√©s na estimativa de par√¢metros em modelos de raiz unit√°ria.
*Proof:*
Provaremos que a presen√ßa de quebras na tend√™ncia pode levar a estimativas viesadas em modelos de raiz unit√°ria.
I. Os testes de raiz unit√°ria, como o teste de Dickey-Fuller, baseiam-se na hip√≥tese nula de que existe uma raiz unit√°ria na s√©rie temporal.
II.  Os testes de raiz unit√°ria analisam a persist√™ncia nos dados. Quebras na tend√™ncia introduzem um comportamento persistente na s√©rie temporal, uma vez que a s√©rie n√£o retorna ao seu n√≠vel anterior ap√≥s uma quebra.
III. Uma s√©rie com uma quebra na tend√™ncia pode parecer ter um comportamento semelhante a uma s√©rie com raiz unit√°ria, mesmo que seja de fato estacion√°ria ao redor de uma tend√™ncia com quebras, j√° que tanto uma raiz unit√°ria quanto uma quebra na tend√™ncia introduzem persist√™ncia na s√©rie temporal.
IV. Os testes de raiz unit√°ria padr√£o podem ter dificuldade em distinguir entre persist√™ncia devido a raiz unit√°ria e persist√™ncia devido a quebras na tend√™ncia.
V. Se uma s√©rie com quebras na tend√™ncia for erroneamente identificada como tendo raiz unit√°ria, a estimativa dos par√¢metros em modelos de raiz unit√°ria ser√° afetada pelo vi√©s induzido pela quebra na tend√™ncia. Isso pode levar a conclus√µes err√¥neas sobre a n√£o estacionariedade da s√©rie temporal.
Portanto, a presen√ßa de quebras na tend√™ncia pode levar a um vi√©s na estimativa dos par√¢metros em modelos de raiz unit√°ria. ‚ñ†

Modelos similares com mudan√ßas na inclina√ß√£o da tend√™ncia foram estudados por Lam (1990), onde ele usou cadeias de Markov para modelar as mudan√ßas na inclina√ß√£o e permitiu que o PNB real dos EUA seguisse um processo autoregressivo estacion√°rio de terceira ordem em torno dessa tend√™ncia [^1]. Suas descobertas sugerem que os eventos que mudaram permanentemente o n√≠vel do PNB coincidiram com as recess√µes de 1957, 1973 e 1980 [^1].

#### Escolhendo o modelo adequado
A escolha entre um modelo trend-stationary, um modelo com raiz unit√°ria ou um modelo com quebras ocasionais na tend√™ncia depende da natureza da s√©rie temporal e da quest√£o de pesquisa. Modelos trend-stationary s√£o adequados para s√©ries com tend√™ncias determin√≠sticas, enquanto modelos de raiz unit√°ria s√£o mais apropriados para s√©ries com tend√™ncias estoc√°sticas. Modelos com diferencia√ß√£o fracion√°ria s√£o √∫teis quando os dados exibem depend√™ncias de longo prazo n√£o capturadas por modelos tradicionais. Os modelos com quebras ocasionais na tend√™ncia podem ser mais adequados para s√©ries temporais que exibem mudan√ßas abruptas na tend√™ncia em per√≠odos espec√≠ficos.

### Conclus√£o
Modelar s√©ries temporais n√£o estacion√°rias √© um desafio. Como foi visto, modelos trend-stationary, com raiz unit√°ria, diferencia√ß√£o fracion√°ria e quebras ocasionais na tend√™ncia s√£o abordagens que buscam capturar as nuances destas s√©ries. A diferencia√ß√£o fracion√°ria oferece uma flexibilidade adicional para modelar depend√™ncias de longo prazo, enquanto os modelos de quebra ocasional podem ser mais adequados para s√©ries com mudan√ßas de tend√™ncia discretas. A escolha do modelo adequado depende da natureza dos dados e da pergunta de pesquisa. O entendimento de cada uma dessas abordagens √© um passo fundamental para a an√°lise e modelagem eficazes de s√©ries temporais n√£o estacion√°rias.

### Refer√™ncias
[^1]: Cap√≠tulo 15 do livro "Time Series Analysis" (informa√ß√µes retiradas de todo o cap√≠tulo).
<!-- END -->
