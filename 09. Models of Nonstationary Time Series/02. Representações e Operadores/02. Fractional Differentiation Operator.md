## Representa√ß√µes e Operadores de Diferencia√ß√£o Fracion√°ria

### Introdu√ß√£o
Em continuidade ao estudo de modelos de s√©ries temporais n√£o estacion√°rias [^1], e ap√≥s a discuss√£o sobre a an√°lise de ra√≠zes e estacionariedade, este cap√≠tulo aprofunda-se no conceito de *integra√ß√£o fracion√°ria*. Expandindo a no√ß√£o de diferencia√ß√£o inteira, exploraremos o operador $(1-L)^d$, onde $L$ √© o operador de defasagem e $d$ √© um n√∫mero real. Este operador permite modelar processos com *mem√≥ria longa* e depend√™ncia temporal de longo alcance, o que √© fundamental para muitas s√©ries econ√¥micas e financeiras. A representa√ß√£o deste operador como uma s√©rie infinita de pot√™ncias de $L$ nos permite entender seus coeficientes e propriedades.

### Conceitos Fundamentais
Como vimos anteriormente [^1], a modelagem de s√©ries temporais n√£o estacion√°rias pode envolver a aplica√ß√£o de diferen√ßas para tornar a s√©rie estacion√°ria.  A diferen√ßa de primeira ordem √© dada por $(1-L)y_t = y_t - y_{t-1}$ e a diferen√ßa de segunda ordem por $(1-L)^2 y_t$.  A diferencia√ß√£o tradicional √© um caso particular da diferencia√ß√£o fracion√°ria, onde a ordem da diferencia√ß√£o √© um n√∫mero inteiro. A integra√ß√£o fracion√°ria generaliza essa ideia permitindo valores n√£o inteiros para a ordem da diferencia√ß√£o, denotada por $d$.

O operador $(1-L)^d$ √© a base para modelar processos *fractionally integrated*. Para entender este operador, vamos considerar a sua expans√£o em s√©rie de pot√™ncias [^1]:

$$(1-L)^d = \sum_{j=0}^{\infty} h_j L^j$$

Onde os coeficientes $h_j$ s√£o dados por [^1]:

$$h_0 = 1$$
$$h_j = \frac{\Gamma(j-d)}{\Gamma(j+1)\Gamma(-d)} = \frac{d(d-1)(d-2)\ldots(d-j+1)}{j!} $$

onde $\Gamma(\cdot)$ √© a fun√ß√£o gama.  Uma express√£o equivalente para $h_j$ [^1] √©:

$$h_j = \frac{(1/j!)(d+j-1)(d+j-2)\ldots(d+1)d}{j!}$$

Esta expans√£o √© crucial para entender o comportamento do operador de diferencia√ß√£o fracion√°ria. Quando $d$ √© um inteiro positivo, este operador coincide com a diferencia√ß√£o tradicional.  Por exemplo, para $d=1$, temos:

$$(1-L)^1 = 1 - L$$
que √© o operador de primeira diferen√ßa.  Para $d=2$, temos:

$$(1-L)^2 = 1 - 2L + L^2$$
que √© o operador de segunda diferen√ßa.

No entanto, a grande vantagem da diferencia√ß√£o fracion√°ria √© que $d$ pode assumir qualquer valor real, permitindo a modelagem de processos que exibem um n√≠vel de persist√™ncia entre a estacionariedade e a n√£o estacionariedade. Por exemplo, para um valor de $d$ entre 0 e 1, o processo ter√° uma depend√™ncia de longo alcance, ou seja, os choques passados ter√£o um efeito que decai mais lentamente do que em um processo estacion√°rio, mas n√£o √© persistente como em um processo com raiz unit√°ria [^1].

> üí° **Exemplo Num√©rico:** Vamos calcular os primeiros coeficientes $h_j$ para $d=0.5$.
>
> $\text{Para } j=0:  h_0 = 1$
>
> $\text{Para } j=1:  h_1 = \frac{0.5}{1!} = 0.5$
>
> $\text{Para } j=2:  h_2 = \frac{0.5(0.5-1)}{2!} = \frac{0.5(-0.5)}{2} = -0.125$
>
> $\text{Para } j=3:  h_3 = \frac{0.5(0.5-1)(0.5-2)}{3!} = \frac{0.5(-0.5)(-1.5)}{6} = 0.0625$
>
>  $\text{Para } j=4:  h_4 = \frac{0.5(0.5-1)(0.5-2)(0.5-3)}{4!} = \frac{0.5(-0.5)(-1.5)(-2.5)}{24} = -0.0390625$
>
> Assim, a expans√£o de $(1-L)^{0.5}$ come√ßa como $1 + 0.5L - 0.125L^2 + 0.0625L^3 - 0.0390625L^4 + \ldots$. Observe que os coeficientes, embora decrescentes, diminuem de forma mais lenta do que um decaimento exponencial, t√≠pico de modelos ARMA estacion√°rios.

**Lema 1**  A representa√ß√£o do operador $(1-L)^d$ como uma s√©rie de pot√™ncias de $L$ converge para $|L| < 1$.

*Prova*:
I.   A converg√™ncia da s√©rie de pot√™ncias $\sum_{j=0}^{\infty} h_j L^j$ pode ser analisada usando o teste da raz√£o. A raz√£o entre termos consecutivos √© dada por:
$$ \left| \frac{h_{j+1} L^{j+1}}{h_j L^j} \right| = \left| \frac{\frac{\Gamma(j+1-d)}{\Gamma(j+2)\Gamma(-d)} L^{j+1}}{\frac{\Gamma(j-d)}{\Gamma(j+1)\Gamma(-d)} L^j} \right| $$
II.  Simplificando a express√£o, obtemos:
$$ \left| \frac{\Gamma(j+1-d)}{\Gamma(j-d)} \frac{\Gamma(j+1)}{\Gamma(j+2)} L \right| $$
III. Usando a propriedade da fun√ß√£o gama $\Gamma(z+1) = z\Gamma(z)$, podemos reescrever a express√£o:
$$ \left| \frac{(j-d)\Gamma(j-d)}{\Gamma(j-d)} \frac{\Gamma(j+1)}{(j+1)\Gamma(j+1)} L \right| = \left| \frac{j-d}{j+1} L \right| $$
IV.  Tomando o limite quando $j \to \infty$, temos que $\frac{j-d}{j+1} \to 1$. Portanto, o limite da raz√£o √© $|L|$.
V.  Pelo teste da raz√£o, a s√©rie converge se $|L| < 1$, o que garante que o operador $(1-L)^d$ esteja bem definido para valores de $L$ dentro do c√≠rculo unit√°rio. $\blacksquare$

Para calcular os coeficientes $h_j$ quando $d$ n√£o √© um inteiro, podemos usar a expans√£o em s√©rie de Taylor [^1]. A fun√ß√£o $f(z) = (1-z)^{-d}$ tem a seguinte s√©rie de Taylor em torno de $z=0$:

$$ f(z) = (1-z)^{-d} = \sum_{j=0}^{\infty} \frac{f^{(j)}(0)}{j!}z^j$$

Onde $f^{(j)}(0)$ √© a $j$-√©sima derivada de $f(z)$ avaliada em $z=0$. As derivadas de $f(z)$ s√£o [^1]:
$$
\begin{aligned}
    f'(z) &= d(1-z)^{-d-1} \\
    f''(z) &= d(d+1)(1-z)^{-d-2} \\
    f'''(z) &= d(d+1)(d+2)(1-z)^{-d-3} \\
    &\vdots \\
    f^{(j)}(z) &= d(d+1)\ldots(d+j-1)(1-z)^{-d-j}
\end{aligned}
$$
Assim, temos que $f^{(j)}(0) = d(d+1)\ldots(d+j-1)$, e consequentemente [^1]:
$$(1-z)^{-d} = 1 + dz + \frac{d(d+1)}{2!}z^2 + \frac{d(d+1)(d+2)}{3!}z^3 + \ldots$$

Substituindo $L$ por $z$, obtemos a seguinte representa√ß√£o do operador de diferencia√ß√£o fracion√°ria [^1]:
$$(1-L)^{-d} = 1 + dL + \frac{d(d+1)}{2!}L^2 + \frac{d(d+1)(d+2)}{3!}L^3 + \ldots$$

Com o uso da fun√ß√£o gama, a forma geral dos coeficientes pode ser escrita como [^1]:
$$ h_j = \frac{\Gamma(j+d)}{\Gamma(j+1)\Gamma(d)} = \frac{(d+j-1)(d+j-2)\ldots d}{j!} = \frac{d(d+1)\ldots(d+j-1)}{j!} $$

Note que esta forma √© equivalente a defini√ß√£o apresentada anteriormente [^1].
Desta forma, para valores de $d$ entre 0 e 1, o efeito de choques passados diminui lentamente com o tempo, mas n√£o desaparece completamente. Este comportamento de mem√≥ria longa √© capturado pelo decaimento hiperb√≥lico dos coeficientes $h_j$ para grandes valores de $j$, em contraste com o decaimento exponencial em modelos estacion√°rios e a persist√™ncia total em modelos com raiz unit√°ria. Para um $j$ grande, os coeficientes $h_j$ podem ser aproximados por [^1]:

$$h_j \approx \frac{j^{d-1}}{\Gamma(d)}$$
Este decaimento hiperb√≥lico implica que a influ√™ncia de choques passados diminui mais lentamente para um processo fracionalmente integrado do que para um processo ARMA padr√£o.

> üí° **Exemplo Num√©rico:** Consideremos um processo com $d = 0.7$. Para grandes valores de $j$, o coeficiente $h_j$ pode ser aproximado por $h_j \approx \frac{j^{0.7-1}}{\Gamma(0.7)} \approx \frac{j^{-0.3}}{1.298}$. Isso mostra que os coeficientes decrescem, mas a uma taxa mais lenta do que $j^{-1}$ (que √© t√≠pico de processos estacion√°rios). Se compararmos com um processo AR(1) onde os coeficientes decaem exponencialmente (e.g., $0.5^j$), a diferen√ßa na taxa de decaimento √© evidente. Um processo com $d = 0.7$ ter√° uma mem√≥ria longa em compara√ß√£o com um AR(1).
>
> ```mermaid
>  graph LR
>      A[Decaimento AR(1)] -->|Exponencial| B(R√°pido);
>      C[Decaimento Fracion√°rio (d=0.7)] -->|Hiperb√≥lico| D(Lento);
> ```

**Proposi√ß√£o 1** O operador $(1-L)^d$ pode ser invertido para $-1 < d < 1$.

*Prova*:
I.   Para garantir a invertibilidade do operador $(1-L)^d$, a s√©rie $\sum_{j=0}^{\infty} h_j L^j$ deve convergir para $|L| \leq 1$.
II.  Pelo Lema 1, sabemos que a s√©rie converge para $|L| < 1$.  Agora, precisamos avaliar o comportamento para $|L| = 1$.
III. Para $L=1$, o operador se torna $(1-1)^d=0$ para qualquer $d >0$. Para que o operador seja invert√≠vel, esse cen√°rio deve ser evitado, o que implica que o operador precisa ser analisado com mais cuidado.
IV.  A converg√™ncia para $|L| = 1$ depende da taxa de decaimento dos coeficientes $h_j$. Conforme discutido, para grandes $j$, $h_j \approx \frac{j^{d-1}}{\Gamma(d)}$.
V.  A s√©rie $\sum_{j=0}^\infty j^{d-1}$ converge quando $d-1 < -1$, ou seja, $d < 0$. Para $d=0$ o operador se torna uma constante (1) e portanto √© invert√≠vel.
VI. Para $d < 0$, a s√©rie converge e o operador √© invert√≠vel. Quando $d > 0$ o operador (1-L)^d possui uma inversa (1-L)^{-d}.
VII. Para o operador $(1-L)^{-d}$ ter coeficientes que convergem, $-d$ deve satisfazer $-1 < -d < 0$, o que implica $0 < d < 1$.  Combinando a necessidade de converg√™ncia tanto para $(1-L)^d$ quanto para sua inversa, a condi√ß√£o para a invertibilidade √© $-1 < d < 1$.
VIII. Portanto, a converg√™ncia √© assegurada quando a condi√ß√£o $|d| < 1$ √© satisfeita, e mais especificamente, para $-1 < d < 1$. Para valores de $d$ fora desse intervalo, o operador $(1-L)^d$ n√£o possui uma inversa bem definida no contexto de s√©ries temporais. A intui√ß√£o por tr√°s dessa condi√ß√£o est√° ligada √† natureza do decaimento dos coeficientes $h_j$. Se $d$ √© maior ou igual a 1, o decaimento de $h_j$ n√£o √© r√°pido o suficiente para garantir a converg√™ncia da s√©rie $\sum_{j=0}^{\infty} h_j L^j$, e para valores de $d$ menores ou iguais a -1 os coeficientes divergem. Essa condi√ß√£o de converg√™ncia reflete a necessidade de que o operador n√£o amplifique de maneira descontrolada os componentes passados da s√©rie, assegurando que a representa√ß√£o seja significativa em termos de an√°lise de s√©ries temporais. $\blacksquare$

> üí° **Exemplo Num√©rico:**  Consideremos o caso em que $d = 1.2$. Neste caso, o operador $(1-L)^{1.2}$ n√£o tem uma inversa bem definida em termos de s√©ries temporais, pois $d$ est√° fora do intervalo $(-1, 1)$. Em contraste, se $d = 0.3$, o operador $(1-L)^{0.3}$ √© invert√≠vel e sua inversa seria $(1-L)^{-0.3}$. Isso significa que, se aplicarmos o operador $(1-L)^{0.3}$ a uma s√©rie, poderemos recuperar a s√©rie original aplicando $(1-L)^{-0.3}$.

A representa√ß√£o de um processo *fractionally integrated* √© dada por [^1]:

$$(1-L)^d y_t = \psi(L)\epsilon_t$$

Onde $\psi(L)$ √© um operador de m√©dia m√≥vel.  Este modelo √© √∫til para descrever fen√¥menos que exibem depend√™ncia de longo alcance, como dados financeiros e macroecon√¥micos [^1].

> üí° **Exemplo Num√©rico:** Suponha que modelamos o logaritmo do pre√ßo de uma a√ß√£o ($y_t$) com $d = 0.8$ e um ru√≠do branco $\epsilon_t$. O modelo seria $(1-L)^{0.8}y_t = \epsilon_t$. Isso significa que as varia√ß√µes no log do pre√ßo da a√ß√£o t√™m uma depend√™ncia de longo alcance, onde os choques passados afetam o valor presente, mas com um decaimento mais lento do que um processo ARMA tradicional.
>
> Para simular esse processo, podemos gerar um ru√≠do branco $\epsilon_t$ (por exemplo, uma sequ√™ncia de n√∫meros aleat√≥rios de uma distribui√ß√£o normal) e aplicar o operador $(1-L)^{-0.8}$ sobre $\epsilon_t$ para obter uma s√©rie $y_t$.
>
>  ```python
> import numpy as np
> import pandas as pd
> from statsmodels.tsa.arima_process import arma_generate_sample
>
> def fractional_difference(series, d, max_lag=1000):
>     weights = np.array([1.0] + [ np.prod([(d-k)/(k+1) for k in range(j)]) for j in range(max_lag)])
>     result = np.convolve(series, weights, mode='full')[:len(series)]
>     return result
>
> np.random.seed(42)
> T = 1000
> epsilon = np.random.normal(0, 1, T)
> d = 0.8
> y = fractional_difference(epsilon, -d, max_lag = 1000)
>
> df = pd.DataFrame({'epsilon': epsilon, 'y': y})
> print(df.head())
> ```
> Esse c√≥digo gera uma s√©rie temporal $y$ que exibe mem√≥ria longa, caracter√≠stica de processos de integra√ß√£o fracion√°ria. A fun√ß√£o `fractional_difference` calcula os coeficientes do operador de diferencia√ß√£o fracion√°ria e os utiliza para transformar a s√©rie $\epsilon_t$ numa s√©rie temporal $y_t$.

A condi√ß√£o para que o processo seja estacion√°rio em termos de $d$ √© que $d < 0.5$ [^1]. Para $0.5 \le d < 1$, o processo √© considerado n√£o estacion√°rio, mas ainda possui revers√£o √† m√©dia.  Se $d \ge 1$, o processo n√£o √© estacion√°rio e n√£o tem revers√£o √† m√©dia.
A diferencia√ß√£o fracion√°ria √© √∫til na modelagem de fen√¥menos onde a persist√™ncia √© maior do que a apresentada em modelos ARMA tradicionais, mas menor do que em modelos com raiz unit√°ria.

### Conclus√£o
A diferencia√ß√£o fracion√°ria, representada pelo operador $(1-L)^d$, oferece uma abordagem flex√≠vel para modelar s√©ries temporais com caracter√≠sticas de *mem√≥ria longa*. A expans√£o deste operador em uma s√©rie infinita de pot√™ncias de $L$ permite entender seus coeficientes e propriedades, revelando um decaimento hiperb√≥lico que captura a persist√™ncia temporal de processos que est√£o entre a estacionariedade e a n√£o estacionariedade. O conceito de diferencia√ß√£o fracion√°ria generaliza o conceito de diferencia√ß√£o inteira, abrindo um espa√ßo para modelar processos com comportamento mais complexo e, por consequ√™ncia, oferecendo uma ferramenta mais rica para analistas de s√©ries temporais.

### Refer√™ncias
[^1]: Modelos de S√©ries Temporais N√£o Estacion√°rias. *[Cap√≠tulo 15 do livro]*
<!-- END -->
